# Python控制结构

## 一、条件语句

### 1.1 if语句

if语句用于根据条件执行不同的代码块。

#### 1.1.1 基本语法

```python
if 条件:
    # 条件为True时执行的代码块
    代码1
    代码2
    ...
```

#### 1.1.2 示例

```python
# 判断一个数是否为正数
num = 10
if num > 0:
    print("这是一个正数")
    print("继续执行")

# 判断一个字符串是否为空
name = "Alice"
if name:
    print(f"Hello, {name}!")
```

### 1.2 if-else语句

if-else语句用于根据条件执行两个不同的代码块。

#### 1.2.1 基本语法

```python
if 条件:
    # 条件为True时执行的代码块
    代码1
    代码2
    ...
else:
    # 条件为False时执行的代码块
    代码1
    代码2
    ...
```

#### 1.2.2 示例

```python
# 判断一个数是否为正数
num = -5
if num > 0:
    print("这是一个正数")
else:
    print("这不是一个正数")

# 判断一个年份是否为闰年
year = 2024
if (year % 4 == 0 and year % 100 != 0) or year % 400 == 0:
    print(f"{year}是闰年")
else:
    print(f"{year}不是闰年")
```

### 1.3 if-elif-else语句

if-elif-else语句用于根据多个条件执行不同的代码块。

#### 1.3.1 基本语法

```python
if 条件1:
    # 条件1为True时执行的代码块
    代码1
    ...
elif 条件2:
    # 条件1为False，条件2为True时执行的代码块
    代码1
    ...
elif 条件3:
    # 条件1和条件2为False，条件3为True时执行的代码块
    代码1
    ...
else:
    # 所有条件都为False时执行的代码块
    代码1
    ...
```

#### 1.3.2 示例

```python
# 判断一个数的正负
num = 0
if num > 0:
    print("这是一个正数")
elif num < 0:
    print("这是一个负数")
else:
    print("这是零")

# 判断成绩等级
score = 85
if score >= 90:
    print("优秀")
elif score >= 80:
    print("良好")
elif score >= 70:
    print("中等")
elif score >= 60:
    print("及格")
else:
    print("不及格")
```

### 1.4 嵌套if语句

嵌套if语句用于在一个if语句内部再使用if语句。

#### 1.4.1 基本语法

```python
if 条件1:
    # 条件1为True时执行的代码块
    if 条件2:
        # 条件2为True时执行的代码块
        代码1
        ...
    else:
        # 条件2为False时执行的代码块
        代码1
        ...
else:
    # 条件1为False时执行的代码块
    代码1
    ...
```

#### 1.4.2 示例

```python
# 判断一个数是否为偶数且为正数
num = 10
if num > 0:
    if num % 2 == 0:
        print("这是一个正偶数")
    else:
        print("这是一个正奇数")
else:
    print("这不是一个正数")

# 判断一个年份是否为闰年且为21世纪
year = 2024
if year >= 2000:
    if (year % 4 == 0 and year % 100 != 0) or year % 400 == 0:
        print(f"{year}是21世纪的闰年")
    else:
        print(f"{year}是21世纪的平年")
else:
    print(f"{year}不是21世纪的年份")
```

## 二、循环语句

### 2.1 while循环

while循环用于重复执行一段代码，直到条件为False。

#### 2.1.1 基本语法

```python
while 条件:
    # 条件为True时执行的代码块
    代码1
    代码2
    ...
    # 通常需要更新循环变量，否则可能导致无限循环
    循环变量更新
```

#### 2.1.2 示例

```python
# 输出1到10
count = 1
while count <= 10:
    print(count)
    count += 1

# 计算1到100的和
sum = 0
num = 1
while num <= 100:
    sum += num
    num += 1
print(f"1到100的和为：{sum}")

# 猜数字游戏
import random
secret_number = random.randint(1, 100)
guess = 0
while guess != secret_number:
    guess = int(input("请输入一个1到100之间的数字："))
    if guess < secret_number:
        print("猜小了")
    elif guess > secret_number:
        print("猜大了")
print(f"恭喜你，猜对了！秘密数字是{secret_number}")
```

### 2.2 for循环

for循环用于遍历可迭代对象（如列表、元组、字符串、字典等）。

#### 2.2.1 基本语法

```python
for 变量 in 可迭代对象:
    # 遍历每个元素时执行的代码块
    代码1
    代码2
    ...
```

#### 2.2.2 示例

```python
# 遍历列表
fruits = ['apple', 'banana', 'orange']
for fruit in fruits:
    print(fruit)

# 遍历字符串
name = "Alice"
for char in name:
    print(char)

# 遍历字典
person = {'name': 'Alice', 'age': 25, 'city': 'New York'}
for key in person:
    print(f"{key}: {person[key]}")

for key, value in person.items():
    print(f"{key}: {value}")

for value in person.values():
    print(value)
```

### 2.3 range()函数

range()函数用于生成一个整数序列，常用于for循环中。

#### 2.3.1 基本语法

```python
range(stop)  # 生成0到stop-1的整数序列
range(start, stop)  # 生成start到stop-1的整数序列
range(start, stop, step)  # 生成start到stop-1的整数序列，步长为step
```

#### 2.3.2 示例

```python
# 生成0到4的整数序列
for i in range(5):
    print(i)  # 输出：0 1 2 3 4

# 生成1到10的整数序列
for i in range(1, 11):
    print(i)  # 输出：1 2 3 4 5 6 7 8 9 10

# 生成1到10的奇数序列
for i in range(1, 11, 2):
    print(i)  # 输出：1 3 5 7 9

# 生成10到1的整数序列
for i in range(10, 0, -1):
    print(i)  # 输出：10 9 8 7 6 5 4 3 2 1

# 计算1到100的和
sum = 0
for i in range(1, 101):
    sum += i
print(f"1到100的和为：{sum}")
```

### 2.4 嵌套循环

嵌套循环是指在一个循环内部再使用一个循环。

#### 2.4.1 基本语法

```python
for 变量1 in 可迭代对象1:
    # 外层循环代码
    for 变量2 in 可迭代对象2:
        # 内层循环代码
        代码1
        代码2
        ...
    # 外层循环代码
```

#### 2.4.2 示例

```python
# 输出九九乘法表
for i in range(1, 10):
    for j in range(1, i+1):
        print(f"{j}×{i}={i*j}", end="\t")
    print()

# 输出三角形
rows = 5
for i in range(1, rows+1):
    for j in range(1, i+1):
        print("*")
    print()

# 输出倒三角形
rows = 5
for i in range(rows, 0, -1):
    for j in range(1, i+1):
        print("*")
    print()
```

## 三、循环控制语句

### 3.1 break语句

break语句用于跳出当前循环，不再执行循环中的剩余代码。

#### 3.1.1 示例

```python
# 输出1到5，遇到3时跳出循环
for i in range(1, 11):
    if i == 6:
        break
    print(i)  # 输出：1 2 3 4 5

# 查找列表中的元素
fruits = ['apple', 'banana', 'orange', 'grape']
target = 'orange'
for fruit in fruits:
    if fruit == target:
        print(f"找到了{target}")
        break
else:
    print(f"没有找到{target}")

# 猜数字游戏，限制5次机会
import random
secret_number = random.randint(1, 100)
for i in range(5):
    guess = int(input(f"第{i+1}次猜测，请输入一个1到100之间的数字："))
    if guess == secret_number:
        print(f"恭喜你，猜对了！秘密数字是{secret_number}")
        break
    elif guess < secret_number:
        print("猜小了")
    else:
        print("猜大了")
else:
    print(f"很遗憾，5次机会用完了，秘密数字是{secret_number}")
```

### 3.2 continue语句

continue语句用于跳过当前循环的剩余代码，直接进入下一次循环。

#### 3.2.1 示例

```python
# 输出1到10中的奇数
for i in range(1, 11):
    if i % 2 == 0:
        continue
    print(i)  # 输出：1 3 5 7 9

# 计算1到100中所有奇数的和
sum = 0
for i in range(1, 101):
    if i % 2 == 0:
        continue
    sum += i
print(f"1到100中所有奇数的和为：{sum}")

# 过滤列表中的空字符串
words = ['hello', '', 'world', '', 'python']
for word in words:
    if not word:
        continue
    print(word)  # 输出：hello world python
```

### 3.3 pass语句

pass语句是一个空语句，用于占位，不执行任何操作。

#### 3.3.1 示例

```python
# 定义一个空函数
def my_function():
    pass  # 占位，后续再实现

# 定义一个空类
class MyClass:
    pass  # 占位，后续再实现

# 在条件语句中使用pass
num = 10
if num > 0:
    pass  # 占位，后续再实现
else:
    print("num是负数")

# 在循环中使用pass
for i in range(5):
    pass  # 占位，后续再实现
```

## 四、列表推导式

列表推导式用于快速创建列表，语法简洁，可读性高。

### 4.1 基本语法

```python
[表达式 for 变量 in 可迭代对象]
[表达式 for 变量 in 可迭代对象 if 条件]
[表达式 for 变量1 in 可迭代对象1 for 变量2 in 可迭代对象2]
```

### 4.2 示例

```python
# 创建一个包含1到10的列表
numbers = [i for i in range(1, 11)]
print(numbers)  # 输出：[1, 2, 3, 4, 5, 6, 7, 8, 9, 10]

# 创建一个包含1到10的平方的列表
squares = [i**2 for i in range(1, 11)]
print(squares)  # 输出：[1, 4, 9, 16, 25, 36, 49, 64, 81, 100]

# 创建一个包含1到10的偶数的列表
evens = [i for i in range(1, 11) if i % 2 == 0]
print(evens)  # 输出：[2, 4, 6, 8, 10]

# 创建一个包含1到10的奇数的列表
odds = [i for i in range(1, 11) if i % 2 != 0]
print(odds)  # 输出：[1, 3, 5, 7, 9]

# 将列表中的字符串转换为大写
words = ['hello', 'world', 'python']
upper_words = [word.upper() for word in words]
print(upper_words)  # 输出：['HELLO', 'WORLD', 'PYTHON']

# 过滤列表中的空字符串
words = ['hello', '', 'world', '', 'python']
non_empty_words = [word for word in words if word]
print(non_empty_words)  # 输出：['hello', 'world', 'python']

# 嵌套列表推导式，创建一个3x3的矩阵
matrix = [[i*3+j for j in range(3)] for i in range(3)]
print(matrix)  # 输出：[[0, 1, 2], [3, 4, 5], [6, 7, 8]]

# 嵌套列表推导式，将二维列表转换为一维列表
matrix = [[1, 2, 3], [4, 5, 6], [7, 8, 9]]
flattened = [num for row in matrix for num in row]
print(flattened)  # 输出：[1, 2, 3, 4, 5, 6, 7, 8, 9]

# 使用列表推导式生成九九乘法表
multiplication_table = [f"{j}×{i}={i*j}" for i in range(1, 10) for j in range(1, i+1)]
print(multiplication_table)
```

## 五、字典推导式

字典推导式用于快速创建字典。

### 5.1 基本语法

```python
{键表达式: 值表达式 for 变量 in 可迭代对象}
{键表达式: 值表达式 for 变量 in 可迭代对象 if 条件}
```

### 5.2 示例

```python
# 创建一个包含1到5的平方的字典
squares = {i: i**2 for i in range(1, 6)}
print(squares)  # 输出：{1: 1, 2: 4, 3: 9, 4: 16, 5: 25}

# 将两个列表合并为字典
keys = ['name', 'age', 'city']
values = ['Alice', 25, 'New York']
person = {keys[i]: values[i] for i in range(len(keys))}
print(person)  # 输出：{'name': 'Alice', 'age': 25, 'city': 'New York'}

# 使用zip函数合并两个列表为字典
keys = ['name', 'age', 'city']
values = ['Alice', 25, 'New York']
person = {key: value for key, value in zip(keys, values)}
print(person)  # 输出：{'name': 'Alice', 'age': 25, 'city': 'New York'}

# 过滤字典中的元素
person = {'name': 'Alice', 'age': 25, 'city': 'New York', 'gender': 'female'}
filtered = {key: value for key, value in person.items() if key != 'gender'}
print(filtered)  # 输出：{'name': 'Alice', 'age': 25, 'city': 'New York'}

# 将字典中的值转换为大写
person = {'name': 'alice', 'city': 'new york'}
upper_person = {key: value.upper() for key, value in person.items()}
print(upper_person)  # 输出：{'name': 'ALICE', 'city': 'NEW YORK'}
```

## 六、集合推导式

集合推导式用于快速创建集合。

### 6.1 基本语法

```python
{表达式 for 变量 in 可迭代对象}
{表达式 for 变量 in 可迭代对象 if 条件}
```

### 6.2 示例

```python
# 创建一个包含1到10的平方的集合
squares = {i**2 for i in range(1, 11)}
print(squares)  # 输出：{64, 1, 4, 36, 100, 9, 16, 49, 81, 25}（集合是无序的）

# 创建一个包含1到10的偶数的集合
evens = {i for i in range(1, 11) if i % 2 == 0}
print(evens)  # 输出：{2, 4, 6, 8, 10}

# 去除列表中的重复元素
numbers = [1, 2, 3, 4, 5, 1, 2, 3]
unique_numbers = {num for num in numbers}
print(unique_numbers)  # 输出：{1, 2, 3, 4, 5}

# 将列表中的字符串转换为大写，并去除重复元素
words = ['hello', 'world', 'python', 'hello', 'world']
upper_words = {word.upper() for word in words}
print(upper_words)  # 输出：{'HELLO', 'WORLD', 'PYTHON'}
```

## 七、生成器表达式

生成器表达式用于创建生成器对象，语法与列表推导式类似，但使用圆括号。

### 7.1 基本语法

```python
(表达式 for 变量 in 可迭代对象)
(表达式 for 变量 in 可迭代对象 if 条件)
```

### 7.2 示例

```python
# 创建一个生成器对象
squares = (i**2 for i in range(1, 11))
print(squares)  # 输出：<generator object <genexpr> at 0x000001234567890>

# 使用next()函数获取生成器的下一个元素
print(next(squares))  # 输出：1
print(next(squares))  # 输出：4
print(next(squares))  # 输出：9

# 使用for循环遍历生成器
squares = (i**2 for i in range(1, 11))
for square in squares:
    print(square)  # 输出：1 4 9 16 25 36 49 64 81 100

# 计算1到100的和，使用生成器表达式
sum = sum(i for i in range(1, 101))
print(sum)  # 输出：5050

# 过滤列表中的元素，使用生成器表达式
numbers = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
evens = (i for i in numbers if i % 2 == 0)
print(list(evens))  # 输出：[2, 4, 6, 8, 10]
```

## 八、综合示例

### 8.1 水仙花数

水仙花数是指一个3位数，其各位数字的立方和等于该数本身。

```python
# 输出所有水仙花数
for i in range(100, 1000):
    # 获取百位、十位、个位数字
    hundreds = i // 100
    tens = (i // 10) % 10
    units = i % 10
    # 判断是否为水仙花数
    if hundreds**3 + tens**3 + units**3 == i:
        print(i)
```

### 8.2 斐波那契数列

斐波那契数列是指前两个数为1，从第三个数开始，每个数等于前两个数的和。

```python
# 输出前20个斐波那契数
n = 20
fib = [1, 1]
for i in range(2, n):
    fib.append(fib[i-1] + fib[i-2])
print(fib)  # 输出：[1, 1, 2, 3, 5, 8, 13, 21, 34, 55, 89, 144, 233, 377, 610, 987, 1597, 2584, 4181, 6765]

# 使用while循环输出斐波那契数，直到超过1000
fib1, fib2 = 1, 1
print(fib1)
print(fib2)
while True:
    fib3 = fib1 + fib2
    if fib3 > 1000:
        break
    print(fib3)
    fib1, fib2 = fib2, fib3
```

### 8.3 素数判断

素数是指大于1的自然数，除了1和它本身外，不能被其他自然数整除。

```python
# 判断一个数是否为素数
def is_prime(n):
    if n <= 1:
        return False
    for i in range(2, int(n**0.5) + 1):
        if n % i == 0:
            return False
    return True

# 输出1到100的素数
for i in range(1, 101):
    if is_prime(i):
        print(i)

# 输出100到200的素数
for i in range(100, 201):
    if is_prime(i):
        print(i)
```

## 九、常见问题与解决方案

### 9.1 无限循环

- **问题**：循环条件永远为True，导致循环无法结束
- **解决方案**：确保循环条件最终会变为False，或者在循环中使用break语句

```python
# 错误示例：无限循环
count = 1
while count <= 10:
    print(count)
    # 忘记更新count变量

# 正确示例
count = 1
while count <= 10:
    print(count)
    count += 1
```

### 9.2 循环变量作用域

- **问题**：在循环外部访问循环变量，得到的是循环结束后的值
- **解决方案**：在Python中，for循环的变量作用域是整个函数，而不是循环内部

```python
# 示例
for i in range(5):
    pass
print(i)  # 输出：4

# 解决方案：使用列表保存循环变量的值
values = []
for i in range(5):
    values.append(i)
print(values)  # 输出：[0, 1, 2, 3, 4]
```

### 9.3 嵌套循环的效率问题

- **问题**：嵌套循环的时间复杂度为O(n²)，对于大数据集效率较低
- **解决方案**：尽量减少嵌套循环的层数，使用更高效的算法

```python
# 示例：查找两个列表中的共同元素
list1 = [1, 2, 3, 4, 5]
list2 = [3, 4, 5, 6, 7]

# 低效方法：嵌套循环
common = []
for i in list1:
    for j in list2:
        if i == j:
            common.append(i)

# 高效方法：使用集合
common = list(set(list1) & set(list2))
```

## 十、总结

本章介绍了Python的控制结构，包括：

1. 条件语句：if语句、if-else语句、if-elif-else语句和嵌套if语句
2. 循环语句：while循环、for循环和嵌套循环
3. 循环控制语句：break语句、continue语句和pass语句
4. 列表推导式：用于快速创建列表
5. 字典推导式：用于快速创建字典
6. 集合推导式：用于快速创建集合
7. 生成器表达式：用于创建生成器对象
8. 综合示例：水仙花数、斐波那契数列和素数判断
9. 常见问题与解决方案

通过本章的学习，你应该已经掌握了Python的控制结构，可以编写更复杂的Python程序了。接下来，我们将学习Python的数据结构，包括列表、元组、字典和集合等。

## 十一、练习

1. 编写一个Python程序，判断一个年份是否为闰年
2. 编写一个Python程序，输出1到100的所有偶数
3. 编写一个Python程序，计算1到100的所有奇数的和
4. 编写一个Python程序，输出九九乘法表
5. 编写一个Python程序，实现猜数字游戏，限制5次机会
6. 编写一个Python程序，输出所有水仙花数
7. 编写一个Python程序，输出前20个斐波那契数
8. 编写一个Python程序，输出1到200的所有素数
9. 使用列表推导式创建一个包含1到100的平方的列表
10. 使用字典推导式将两个列表合并为字典

## 十二、参考资料

1. Python官方文档：https://docs.python.org/zh-cn/3/tutorial/controlflow.html
2. 《Python编程：从入门到实践》（Eric Matthes）
3. 《流畅的Python》（Luciano Ramalho）
4. 《Python核心编程》（Wesley Chun）
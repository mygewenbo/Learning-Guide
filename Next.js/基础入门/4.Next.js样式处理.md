# Next.js样式处理

## 一、样式处理概述

Next.js提供了多种样式处理方案，支持从传统的CSS到现代的CSS-in-JS等多种方式。选择合适的样式方案对于构建可维护、高性能的Next.js应用非常重要。

Next.js支持的样式方案包括：

1. **全局CSS**：传统的全局样式表
2. **CSS Modules**：模块化CSS，避免样式冲突
3. **Tailwind CSS**：实用优先的CSS框架
4. **CSS-in-JS**：如styled-components、emotion等
5. **Sass/SCSS**：CSS预处理器
6. **CSS变量**：原生CSS变量

## 二、全局CSS

### 2.1 全局CSS概述

全局CSS是最传统的样式处理方式，通过导入CSS文件来应用全局样式。在Next.js中，全局CSS文件需要在特定位置导入，以确保样式正确应用。

### 2.2 App Router中的全局CSS

在App Router中，全局CSS文件需要在根布局组件（`src/app/layout.tsx`）中导入：

```tsx
// src/app/layout.tsx
import './globals.css'

export default function RootLayout({
  children,
}: {
  children: React.ReactNode
}) {
  return (
    <html lang="en">
      <body>{children}</body>
    </html>
  )
}
```

全局CSS文件示例：

```css
/* src/app/globals.css */
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
  line-height: 1.6;
  color: #333;
  background-color: #fff;
}

h1 {
  font-size: 2rem;
  margin-bottom: 1rem;
}

p {
  margin-bottom: 1rem;
}
```

### 2.3 Pages Router中的全局CSS

在Pages Router中，全局CSS文件需要在`_app.tsx`或`_app.jsx`文件中导入：

```tsx
// src/pages/_app.tsx
import './globals.css'
import type { AppProps } from 'next/app'

export default function App({ Component, pageProps }: AppProps) {
  return <Component {...pageProps} />
}
```

### 2.4 全局CSS的优缺点

**优点**：
- 简单易用，学习成本低
- 适合定义全局样式，如重置样式、主题样式等
- 性能好，加载速度快

**缺点**：
- 容易产生样式冲突
- 样式作用域不明确，难以维护
- 不支持组件级别的样式隔离

## 三、CSS Modules

### 3.1 CSS Modules概述

CSS Modules是一种模块化CSS方案，通过将CSS类名编译为唯一的哈希值，避免样式冲突。在Next.js中，CSS Modules文件使用`.module.css`或`.module.scss`扩展名。

### 3.2 CSS Modules使用

创建CSS Modules文件：

```css
/* src/components/Button.module.css */
.button {
  padding: 0.5rem 1rem;
  border: none;
  border-radius: 4px;
  font-size: 1rem;
  cursor: pointer;
  transition: background-color 0.2s ease;
}

.primary {
  background-color: #0070f3;
  color: white;
}

.primary:hover {
  background-color: #0051c7;
}

.secondary {
  background-color: #f0f0f0;
  color: #333;
}

.secondary:hover {
  background-color: #e0e0e0;
}
```

在组件中使用CSS Modules：

```tsx
// src/components/Button.tsx
import styles from './Button.module.css'

type ButtonProps = {
  children: React.ReactNode
  variant?: 'primary' | 'secondary'
  onClick?: () => void
}

export default function Button({
  children,
  variant = 'primary',
  onClick,
}: ButtonProps) {
  return (
    <button
      className={`${styles.button} ${styles[variant]}`}
      onClick={onClick}
    >
      {children}
    </button>
  )
}
```

### 3.3 CSS Modules特性

#### 3.3.1 样式隔离

CSS Modules通过将CSS类名编译为唯一的哈希值，实现样式隔离，避免样式冲突：

```html
<!-- 编译前 -->
<button class="button primary">Click me</button>

<!-- 编译后 -->
<button class="Button_button__1a2b3 Button_primary__4c5d6">Click me</button>
```

#### 3.3.2 组合样式

CSS Modules支持组合样式，可以在一个类中引用另一个类：

```css
/* src/components/Card.module.css */
.card {
  padding: 1rem;
  border: 1px solid #e0e0e0;
  border-radius: 8px;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

.header {
  font-size: 1.25rem;
  font-weight: bold;
  margin-bottom: 0.5rem;
}

.content {
  color: #666;
}

/* 组合样式 */
.featured {
  composes: card;
  border-color: #0070f3;
  box-shadow: 0 4px 8px rgba(0, 112, 243, 0.1);
}
```

#### 3.3.3 动态类名

CSS Modules支持动态类名，可以根据组件的props或state动态应用样式：

```tsx
// src/components/Card.tsx
import styles from './Card.module.css'

type CardProps = {
  children: React.ReactNode
  featured?: boolean
}

export default function Card({
  children,
  featured = false,
}: CardProps) {
  return (
    <div className={featured ? styles.featured : styles.card}>
      {children}
    </div>
  )
}
```

### 3.4 CSS Modules的优缺点

**优点**：
- 样式隔离，避免样式冲突
- 组件级别的样式管理，易于维护
- 支持组合样式和动态类名
- 性能好，加载速度快
- 学习成本低，容易上手

**缺点**：
- 不支持CSS变量的动态更新
- 不支持主题切换（需要额外配置）
- 样式复用需要手动组合

## 四、Tailwind CSS

### 4.1 Tailwind CSS概述

Tailwind CSS是一种实用优先的CSS框架，通过预定义的工具类来构建UI。它提供了大量的CSS工具类，可以直接在HTML元素上使用，无需编写自定义CSS。

### 4.2 Tailwind CSS安装

在Next.js项目中安装Tailwind CSS：

1. 安装依赖：

```bash
# 使用npm
npm install -D tailwindcss postcss autoprefixer

# 使用yarn
yarn add -D tailwindcss postcss autoprefixer

# 使用pnpm
pnpm add -D tailwindcss postcss autoprefixer
```

2. 初始化Tailwind CSS：

```bash
npx tailwindcss init -p
```

3. 配置Tailwind CSS：

```js
// tailwind.config.ts
import type { Config } from 'tailwindcss'

const config: Config = {
  content: [
    './src/pages/**/*.{js,ts,jsx,tsx,mdx}',
    './src/components/**/*.{js,ts,jsx,tsx,mdx}',
    './src/app/**/*.{js,ts,jsx,tsx,mdx}',
  ],
  theme: {
    extend: {
      colors: {
        primary: '#0070f3',
      },
    },
  },
  plugins: [],
}
export default config
```

4. 在全局CSS文件中添加Tailwind CSS指令：

```css
/* src/app/globals.css */
@tailwind base;
@tailwind components;
@tailwind utilities;

/* 自定义全局样式 */
body {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
}
```

### 4.3 Tailwind CSS使用

在组件中使用Tailwind CSS：

```tsx
// src/components/Button.tsx
type ButtonProps = {
  children: React.ReactNode
  variant?: 'primary' | 'secondary'
  onClick?: () => void
}

export default function Button({
  children,
  variant = 'primary',
  onClick,
}: ButtonProps) {
  return (
    <button
      onClick={onClick}
      className={`px-4 py-2 rounded-md font-medium transition-colors duration-200 ${
        variant === 'primary'
          ? 'bg-primary text-white hover:bg-blue-600'
          : 'bg-gray-200 text-gray-800 hover:bg-gray-300'
      }`}
    >
      {children}
    </button>
  )
}
```

### 4.4 Tailwind CSS特性

#### 4.4.1 实用优先的设计

Tailwind CSS提供了大量的实用类，可以直接在HTML元素上使用，无需编写自定义CSS：

```tsx
<div className="flex items-center justify-between p-4 bg-white rounded-lg shadow-md">
  <h2 className="text-xl font-bold text-gray-800">Title</h2>
  <p className="text-gray-600">Description</p>
</div>
```

#### 4.4.2 响应式设计

Tailwind CSS内置了响应式设计支持，可以使用断点前缀来实现响应式布局：

```tsx
<div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
  <div className="p-4 bg-white rounded-lg shadow-md">Item 1</div>
  <div className="p-4 bg-white rounded-lg shadow-md">Item 2</div>
  <div className="p-4 bg-white rounded-lg shadow-md">Item 3</div>
</div>
```

#### 4.4.3 自定义主题

Tailwind CSS支持自定义主题，可以在`tailwind.config.ts`中配置颜色、字体、间距等：

```js
// tailwind.config.ts
const config: Config = {
  theme: {
    extend: {
      colors: {
        primary: '#0070f3',
        secondary: '#f0f0f0',
      },
      fontFamily: {
        sans: ['Inter', 'sans-serif'],
      },
    },
  },
}
```

#### 4.4.4 组件类

可以使用`@layer components`指令来创建组件类，复用常用的样式组合：

```css
/* src/app/globals.css */
@tailwind base;
@tailwind components;
@tailwind utilities;

@layer components {
  .btn {
    @apply px-4 py-2 rounded-md font-medium transition-colors duration-200;
  }

  .btn-primary {
    @apply bg-primary text-white hover:bg-blue-600;
  }

  .btn-secondary {
    @apply bg-gray-200 text-gray-800 hover:bg-gray-300;
  }
}
```

然后在组件中使用：

```tsx
<button className="btn btn-primary">Primary Button</button>
<button className="btn btn-secondary">Secondary Button</button>
```

### 4.5 Tailwind CSS的优缺点

**优点**：
- 快速构建UI，无需编写大量自定义CSS
- 响应式设计支持，易于实现不同屏幕尺寸的布局
- 自定义主题，支持品牌化设计
- 组件类支持，易于复用样式
- 性能好，只生成使用的样式
- 学习成本低，容易上手

**缺点**：
- HTML代码可能变得冗长
- 需要记忆大量的工具类
- 不适合复杂的自定义样式
- 迁移成本高，一旦使用难以切换到其他样式方案

## 五、CSS-in-JS

### 5.1 CSS-in-JS概述

CSS-in-JS是一种将CSS代码写在JavaScript中的样式处理方案。它允许开发者在组件中直接编写CSS，实现样式与组件的紧密结合。

Next.js支持多种CSS-in-JS库，如：
- styled-components
- emotion
- styled-jsx（Next.js内置）

### 5.2 styled-components

#### 5.2.1 styled-components安装

```bash
# 使用npm
npm install styled-components

# 使用yarn
yarn add styled-components

# 使用pnpm
pnpm add styled-components
```

#### 5.2.2 styled-components配置

在Next.js中使用styled-components需要配置Next.js编译器：

```mjs
// next.config.mjs
/** @type {import('next').NextConfig} */
const nextConfig = {
  compiler: {
    styledComponents: true,
  },
}

export default nextConfig
```

#### 5.2.3 styled-components使用

```tsx
// src/components/Button.tsx
'use client'
import styled from 'styled-components'

type ButtonProps = {
  children: React.ReactNode
  variant?: 'primary' | 'secondary'
  onClick?: () => void
}

const StyledButton = styled.button<{ variant: 'primary' | 'secondary' }>`
  padding: 0.5rem 1rem;
  border: none;
  border-radius: 4px;
  font-size: 1rem;
  cursor: pointer;
  transition: background-color 0.2s ease;
  
  ${props => props.variant === 'primary' && `
    background-color: #0070f3;
    color: white;
    
    &:hover {
      background-color: #0051c7;
    }
  `}
  
  ${props => props.variant === 'secondary' && `
    background-color: #f0f0f0;
    color: #333;
    
    &:hover {
      background-color: #e0e0e0;
    }
  `}
`

export default function Button({
  children,
  variant = 'primary',
  onClick,
}: ButtonProps) {
  return (
    <StyledButton variant={variant} onClick={onClick}>
      {children}
    </StyledButton>
  )
}
```

### 5.3 emotion

#### 5.3.1 emotion安装

```bash
# 使用npm
npm install @emotion/react @emotion/styled

# 使用yarn
yarn add @emotion/react @emotion/styled

# 使用pnpm
pnpm add @emotion/react @emotion/styled
```

#### 5.3.2 emotion使用

```tsx
// src/components/Button.tsx
'use client'
import styled from '@emotion/styled'

type ButtonProps = {
  children: React.ReactNode
  variant?: 'primary' | 'secondary'
  onClick?: () => void
}

const StyledButton = styled.button<{ variant: 'primary' | 'secondary' }>`
  padding: 0.5rem 1rem;
  border: none;
  border-radius: 4px;
  font-size: 1rem;
  cursor: pointer;
  transition: background-color 0.2s ease;
  
  background-color: ${props => props.variant === 'primary' ? '#0070f3' : '#f0f0f0'};
  color: ${props => props.variant === 'primary' ? 'white' : '#333'};
  
  &:hover {
    background-color: ${props => props.variant === 'primary' ? '#0051c7' : '#e0e0e0'};
  }
`

export default function Button({
  children,
  variant = 'primary',
  onClick,
}: ButtonProps) {
  return (
    <StyledButton variant={variant} onClick={onClick}>
      {children}
    </StyledButton>
  )
}
```

### 5.4 styled-jsx

styled-jsx是Next.js内置的CSS-in-JS库，无需额外安装。

```tsx
// src/components/Button.tsx
type ButtonProps = {
  children: React.ReactNode
  variant?: 'primary' | 'secondary'
  onClick?: () => void
}

export default function Button({
  children,
  variant = 'primary',
  onClick,
}: ButtonProps) {
  return (
    <>
      <button className={`btn btn-${variant}`} onClick={onClick}>
        {children}
      </button>
      <style jsx>{`
        .btn {
          padding: 0.5rem 1rem;
          border: none;
          border-radius: 4px;
          font-size: 1rem;
          cursor: pointer;
          transition: background-color 0.2s ease;
        }

        .btn-primary {
          background-color: #0070f3;
          color: white;
        }

        .btn-primary:hover {
          background-color: #0051c7;
        }

        .btn-secondary {
          background-color: #f0f0f0;
          color: #333;
        }

        .btn-secondary:hover {
          background-color: #e0e0e0;
        }
      `}</style>
    </>
  )
}
```

### 5.5 CSS-in-JS的优缺点

**优点**：
- 样式与组件紧密结合，易于维护
- 支持动态样式，如主题切换
- 支持CSS变量的动态更新
- 组件级别的样式隔离
- 支持嵌套样式和伪类

**缺点**：
- 性能开销较大，尤其是在客户端渲染时
- 学习成本高，需要掌握JavaScript和CSS
- 调试困难，样式代码混在JavaScript中
- 服务器端渲染需要额外配置

## 六、Sass/SCSS

### 6.1 Sass/SCSS概述

Sass/SCSS是一种CSS预处理器，提供了变量、嵌套、混合宏等功能，可以简化CSS的编写和维护。

### 6.2 Sass/SCSS安装

在Next.js项目中安装Sass/SCSS：

```bash
# 使用npm
npm install -D sass

# 使用yarn
yarn add -D sass

# 使用pnpm
pnpm add -D sass
```

### 6.3 Sass/SCSS使用

创建SCSS文件：

```scss
/* src/components/Button.module.scss */
$primary-color: #0070f3;
$secondary-color: #f0f0f0;

.button {
  padding: 0.5rem 1rem;
  border: none;
  border-radius: 4px;
  font-size: 1rem;
  cursor: pointer;
  transition: background-color 0.2s ease;

  &.primary {
    background-color: $primary-color;
    color: white;

    &:hover {
      background-color: darken($primary-color, 10%);
    }
  }

  &.secondary {
    background-color: $secondary-color;
    color: #333;

    &:hover {
      background-color: darken($secondary-color, 10%);
    }
  }
}
```

在组件中使用：

```tsx
// src/components/Button.tsx
import styles from './Button.module.scss'

type ButtonProps = {
  children: React.ReactNode
  variant?: 'primary' | 'secondary'
  onClick?: () => void
}

export default function Button({
  children,
  variant = 'primary',
  onClick,
}: ButtonProps) {
  return (
    <button
      className={`${styles.button} ${styles[variant]}`}
      onClick={onClick}
    >
      {children}
    </button>
  )
}
```

### 6.4 Sass/SCSS的优缺点

**优点**：
- 支持变量、嵌套、混合宏等功能，简化CSS编写
- 支持继承和模块化，易于维护
- 学习成本低，容易上手
- 性能好，编译后生成普通CSS

**缺点**：
- 需要编译，增加构建时间
- 不支持动态样式（需要额外配置）
- 不支持主题切换（需要额外配置）

## 七、样式方案选择

选择合适的样式方案需要考虑以下因素：

| 考虑因素 | 全局CSS | CSS Modules | Tailwind CSS | CSS-in-JS | Sass/SCSS |
|---------|---------|-------------|--------------|-----------|-----------|
| **学习成本** | 低 | 低 | 中 | 高 | 中 |
| **开发速度** | 慢 | 中 | 快 | 中 | 中 |
| **性能** | 好 | 好 | 好 | 一般 | 好 |
| **样式隔离** | 差 | 好 | 好 | 好 | 好 |
| **动态样式** | 差 | 差 | 中 | 好 | 差 |
| **主题支持** | 差 | 差 | 好 | 好 | 差 |
| **响应式设计** | 中 | 中 | 好 | 中 | 中 |
| **代码维护性** | 差 | 好 | 中 | 好 | 好 |

### 7.1 推荐样式方案

根据不同的项目需求，推荐以下样式方案：

1. **小型项目**：Tailwind CSS或CSS Modules
2. **中型项目**：Tailwind CSS + CSS Modules
3. **大型项目**：Tailwind CSS + CSS Modules + 少量CSS-in-JS
4. **需要动态样式的项目**：CSS-in-JS（如styled-components或emotion）
5. **需要主题切换的项目**：CSS-in-JS或Tailwind CSS
6. **迁移现有项目**：CSS Modules或Sass/SCSS

### 7.2 样式方案组合

在实际项目中，可以组合使用多种样式方案，如：

- 使用Tailwind CSS构建基础UI
- 使用CSS Modules处理组件级别的样式
- 使用CSS-in-JS处理动态样式和主题切换
- 使用全局CSS定义重置样式和基础样式

## 八、样式最佳实践

### 8.1 样式组织

- 保持样式文件与组件文件的紧密结合
- 使用模块化的样式方案，如CSS Modules或CSS-in-JS
- 避免使用全局样式，除非必要
- 为样式文件使用清晰的命名约定

### 8.2 性能优化

- 只加载需要的样式
- 避免使用过于复杂的CSS选择器
- 使用CSS变量代替重复的样式值
- 优化字体和图像加载
- 避免在运行时动态生成大量样式

### 8.3 可维护性

- 使用清晰的命名约定
- 注释复杂的样式代码
- 避免样式重复
- 使用样式lint工具检查样式代码
- 定期清理未使用的样式

### 8.4 响应式设计

- 使用移动优先的设计理念
- 为不同的屏幕尺寸设计合适的布局
- 使用相对单位，如rem、em、vw等
- 避免使用固定像素值

## 九、总结

本章节我们学习了Next.js的样式处理方案：

1. **全局CSS**：传统的全局样式表，适合定义基础样式
2. **CSS Modules**：模块化CSS，避免样式冲突，适合组件级别的样式管理
3. **Tailwind CSS**：实用优先的CSS框架，快速构建UI，适合响应式设计
4. **CSS-in-JS**：将CSS写在JavaScript中，支持动态样式和主题切换
5. **Sass/SCSS**：CSS预处理器，支持变量、嵌套、混合宏等功能

选择合适的样式方案对于构建可维护、高性能的Next.js应用非常重要。在实际项目中，可以根据项目需求组合使用多种样式方案，如Tailwind CSS + CSS Modules + 少量CSS-in-JS。

通过本章节的学习，你应该能够：
- 理解Next.js支持的多种样式处理方案
- 掌握CSS Modules、Tailwind CSS和CSS-in-JS的使用
- 根据项目需求选择合适的样式方案
- 应用样式最佳实践，构建可维护、高性能的Next.js应用

## 十、练习

1. 创建一个Next.js项目，尝试使用不同的样式方案：
   - 全局CSS
   - CSS Modules
   - Tailwind CSS
   - CSS-in-JS（如styled-components或emotion）
   - Sass/SCSS

2. 实现一个简单的组件，使用不同的样式方案，比较它们的优缺点

3. 实现一个响应式布局，使用Tailwind CSS或CSS Grid/Flexbox

4. 实现主题切换功能，使用CSS-in-JS或CSS变量

5. 优化样式性能，如代码分割、懒加载等

6. 应用样式最佳实践，组织和维护样式代码

---

**下一章预告**：Next.js App Router深入

在接下来的章节中，我们将深入学习Next.js的App Router，包括嵌套布局、并行路由、拦截路由等高级路由功能。
# Next.js基础功能

## 一、Link组件

### 1.1 Link组件概述

`Link`组件是Next.js提供的客户端导航组件，用于在不同页面之间进行导航，而不需要重新加载整个页面。它基于HTML的`<a>`标签，但提供了额外的优化功能，如预取（prefetching）和客户端导航。

### 1.2 Link组件使用

使用`Link`组件非常简单，只需要导入并使用即可：

```tsx
import Link from 'next/link'

export default function Navbar() {
  return (
    <nav>
      <ul>
        <li>
          <Link href="/">Home</Link>
        </li>
        <li>
          <Link href="/about">About</Link>
        </li>
        <li>
          <Link href="/blog">Blog</Link>
        </li>
      </ul>
    </nav>
  )
}
```

### 1.3 Link组件特性

#### 1.3.1 预取（Prefetching）

`Link`组件默认会预取链接指向的页面，当用户将鼠标悬停在链接上时，Next.js会在后台预加载目标页面的JavaScript和数据，从而提升导航速度。

可以通过`prefetch`属性控制预取行为：

```tsx
// 启用预取（默认）
<Link href="/about" prefetch>
  About
</Link>

// 禁用预取
<Link href="/about" prefetch={false}>
  About
</Link>
```

#### 1.3.2 客户端导航

`Link`组件使用客户端导航，即通过JavaScript更新页面内容，而不需要重新加载整个页面。这使得导航更加流畅，提升了用户体验。

#### 1.3.3 动态路由

`Link`组件支持动态路由，可以传递参数：

```tsx
<Link href={`/blog/${post.id}`}>
  {post.title}
</Link>
```

#### 1.3.4 替换历史记录

可以通过`replace`属性替换当前历史记录，而不是添加新的历史记录：

```tsx
<Link href="/login" replace>
  Login
</Link>
```

### 1.4 Link组件与a标签的区别

| 特性 | Link组件 | a标签 |
|------|----------|-------|
| 客户端导航 | ✅ | ❌ |
| 预取 | ✅ | ❌ |
| 自动代码分割 | ✅ | ❌ |
| 动态路由支持 | ✅ | ❌ |
| 历史记录管理 | ✅ | ❌ |
| 样式继承 | ✅ | ✅ |

## 二、Image组件

### 2.1 Image组件概述

`Image`组件是Next.js提供的图像优化组件，用于自动优化图像，提升应用性能。它基于HTML的`<img>`标签，但提供了额外的优化功能，如自动调整大小、响应式图像、懒加载等。

### 2.2 Image组件使用

使用`Image`组件需要导入并使用：

```tsx
import Image from 'next/image'

export default function Hero() {
  return (
    <div>
      <h1>Welcome to Next.js</h1>
      <Image
        src="/hero.jpg"
        alt="Hero Image"
        width={1200}
        height={600}
        priority
      />
    </div>
  )
}
```

### 2.3 Image组件特性

#### 2.3.1 自动优化

`Image`组件会自动优化图像，包括：
- 调整图像大小，适配不同设备
- 转换图像格式，使用现代格式如WebP
- 压缩图像，减少文件大小
- 生成多种分辨率的图像，支持响应式设计

#### 2.3.2 懒加载

`Image`组件默认启用懒加载，即只有当图像进入视口时才会加载，从而减少初始页面加载时间。

可以通过`priority`属性设置图像为高优先级，优先加载：

```tsx
<Image
  src="/hero.jpg"
  alt="Hero Image"
  width={1200}
  height={600}
  priority // 高优先级，优先加载
/>
```

#### 2.3.3 响应式图像

`Image`组件支持响应式图像，可以根据设备尺寸自动调整图像大小：

```tsx
<Image
  src="/responsive.jpg"
  alt="Responsive Image"
  fill // 填充父容器
  sizes="(max-width: 768px) 100vw, (max-width: 1200px) 50vw, 33vw"
/>
```

#### 2.3.4 外部图像

`Image`组件支持外部图像，但需要在`next.config.mjs`中配置`domains`：

```mjs
// next.config.mjs
/** @type {import('next').NextConfig} */
const nextConfig = {
  images: {
    domains: ['example.com', 'another-domain.com'],
  },
}

export default nextConfig
```

然后可以使用外部图像：

```tsx
<Image
  src="https://example.com/image.jpg"
  alt="External Image"
  width={800}
  height={600}
/>
```

### 2.4 Image组件与img标签的区别

| 特性 | Image组件 | img标签 |
|------|-----------|---------|
| 自动优化 | ✅ | ❌ |
| 懒加载 | ✅ | 需要手动配置 |
| 响应式图像 | ✅ | 需要手动配置 |
| 现代图像格式 | ✅ | 需要手动配置 |
| 外部图像支持 | ✅（需要配置） | ✅ |
| 宽高比保持 | ✅ | 需要手动配置 |

## 三、Script组件

### 3.1 Script组件概述

`Script`组件是Next.js提供的脚本优化组件，用于智能加载第三方脚本，提升应用性能。它基于HTML的`<script>`标签，但提供了额外的优化功能，如延迟加载、预加载等。

### 3.2 Script组件使用

使用`Script`组件需要导入并使用：

```tsx
import Script from 'next/script'

export default function Layout({
  children,
}: {
  children: React.ReactNode
}) {
  return (
    <html lang="en">
      <body>
        {children}
        <Script src="https://example.com/script.js" />
      </body>
    </html>
  )
}
```

### 3.3 Script组件特性

#### 3.3.1 加载策略

`Script`组件支持多种加载策略，可以根据脚本的重要性选择合适的加载策略：

| 加载策略 | 描述 | 适用场景 |
|---------|------|----------|
| **beforeInteractive** | 在页面交互之前加载脚本 | 关键脚本，如分析脚本 |
| **afterInteractive** | 在页面交互之后加载脚本 | 非关键脚本，如广告脚本 |
| **lazyOnload** | 在页面完全加载后加载脚本 | 低优先级脚本，如聊天插件 |
| **worker** | 在Web Worker中加载脚本 | 计算密集型脚本 |

```tsx
// 在页面交互之前加载脚本
<Script src="https://example.com/analytics.js" strategy="beforeInteractive" />

// 在页面交互之后加载脚本
<Script src="https://example.com/ads.js" strategy="afterInteractive" />

// 在页面完全加载后加载脚本
<Script src="https://example.com/chat.js" strategy="lazyOnload" />

// 在Web Worker中加载脚本
<Script src="https://example.com/compute.js" strategy="worker" />
```

#### 3.3.2 内联脚本

`Script`组件支持内联脚本：

```tsx
<Script id="my-script">
  {`
    console.log('Hello from inline script!')
  `}
</Script>
```

#### 3.3.3 脚本事件

`Script`组件支持脚本事件，如`onLoad`、`onError`等：

```tsx
<Script
  src="https://example.com/script.js"
  onLoad={() => {
    console.log('Script loaded successfully!')
  }}
  onError={(e) => {
    console.error('Script failed to load:', e)
  }}
/>
```

### 3.4 Script组件与script标签的区别

| 特性 | Script组件 | script标签 |
|------|------------|------------|
| 智能加载策略 | ✅ | 需要手动配置 |
| 延迟加载 | ✅ | 需要手动配置 |
| 预加载 | ✅ | 需要手动配置 |
| Web Worker支持 | ✅ | ❌ |
| 脚本事件 | ✅ | 需要手动配置 |
| 性能优化 | ✅ | 需要手动优化 |

## 四、Head组件与元数据

### 4.1 元数据概述

元数据（Metadata）是描述网页内容的数据，包括标题、描述、关键词等。元数据对于SEO（搜索引擎优化）非常重要，可以帮助搜索引擎理解网页内容，提升网页在搜索结果中的排名。

### 4.2 App Router中的元数据

在App Router中，可以通过`metadata`对象或`generateMetadata`函数来定义元数据：

#### 4.2.1 静态元数据

使用`metadata`对象定义静态元数据：

```tsx
// src/app/page.tsx
import type { Metadata } from 'next'

export const metadata: Metadata = {
  title: 'My Next.js App',
  description: 'A Next.js application with metadata',
  keywords: ['Next.js', 'React', 'SEO'],
  authors: [{ name: 'John Doe' }],
  openGraph: {
    title: 'My Next.js App',
    description: 'A Next.js application with metadata',
    url: 'https://example.com',
    siteName: 'My Next.js App',
    images: [
      {
        url: 'https://example.com/og-image.jpg',
        width: 1200,
        height: 630,
      },
    ],
    locale: 'en_US',
    type: 'website',
  },
}

export default function Home() {
  return <h1>Home Page</h1>
}
```

#### 4.2.2 动态元数据

使用`generateMetadata`函数定义动态元数据：

```tsx
// src/app/blog/[id]/page.tsx
import type { Metadata, ResolvingMetadata } from 'next'
import { fetchPost } from '@/lib/api'

type Props = {
  params: { id: string }
  searchParams: { [key: string]: string | string[] | undefined }
}

export async function generateMetadata(
  { params, searchParams }: Props,
  parent: ResolvingMetadata
): Promise<Metadata> {
  // 获取文章数据
  const post = await fetchPost(params.id)

  // 获取父级元数据
  const previousImages = (await parent).openGraph?.images || []

  return {
    title: post.title,
    description: post.excerpt,
    openGraph: {
      title: post.title,
      description: post.excerpt,
      images: [`https://example.com/blog/${post.id}/og-image.jpg`, ...previousImages],
    },
  }
}

export default async function BlogPost({ params }: Props) {
  const post = await fetchPost(params.id)
  return <h1>{post.title}</h1>
}
```

### 4.3 Pages Router中的Head组件

在Pages Router中，可以使用`Head`组件来定义元数据：

```tsx
// src/pages/index.tsx
import Head from 'next/head'

export default function Home() {
  return (
    <div>
      <Head>
        <title>My Next.js App</title>
        <meta name="description" content="A Next.js application" />
        <meta name="keywords" content="Next.js, React, SEO" />
        <link rel="icon" href="/favicon.ico" />
      </Head>
      <h1>Home Page</h1>
    </div>
  )
}
```

## 五、Font组件

### 5.1 Font组件概述

`Font`组件是Next.js提供的字体优化组件，用于自动优化字体加载，提升应用性能。它支持Google Fonts、Typekit等字体服务，以及自定义字体。

### 5.2 Font组件使用

使用`Font`组件需要导入并配置：

```tsx
// src/app/layout.tsx
import { Inter, Roboto_Mono } from 'next/font/google'
import './globals.css'

// 配置Google Fonts
const inter = Inter({
  subsets: ['latin'],
  display: 'swap',
  variable: '--font-inter',
})

const robotoMono = Roboto_Mono({
  subsets: ['latin'],
  display: 'swap',
  variable: '--font-roboto-mono',
})

export default function RootLayout({
  children,
}: {
  children: React.ReactNode
}) {
  return (
    <html lang="en" className={`${inter.variable} ${robotoMono.variable}`}>
      <body>
        {children}
      </body>
    </html>
  )
}
```

然后在CSS中使用字体变量：

```css
/* src/app/globals.css */
body {
  font-family: var(--font-inter), sans-serif;
}

code {
  font-family: var(--font-roboto-mono), monospace;
}
```

### 5.3 Font组件特性

#### 5.3.1 自动优化

`Font`组件会自动优化字体加载，包括：
- 预加载关键字体
- 自动选择最佳字体格式
- 减少字体文件大小
- 优化字体加载顺序

#### 5.3.2 字体子集

`Font`组件支持字体子集，可以只加载需要的字符，减少字体文件大小：

```tsx
const inter = Inter({
  subsets: ['latin', 'latin-ext'], // 加载拉丁和扩展拉丁字符
})
```

#### 5.3.3 自定义字体

`Font`组件支持自定义字体，可以加载本地字体文件：

```tsx
// src/app/layout.tsx
import localFont from 'next/font/local'

const myFont = localFont({
  src: [
    {
      path: './fonts/my-font-regular.woff2',
      weight: '400',
      style: 'normal',
    },
    {
      path: './fonts/my-font-bold.woff2',
      weight: '700',
      style: 'normal',
    },
  ],
  variable: '--font-my-font',
})
```

## 六、Layout组件

### 6.1 Layout组件概述

Layout组件用于定义页面的整体结构，如导航栏、页脚等。在App Router中，Layout组件是核心概念，支持嵌套布局。

### 6.2 App Router中的Layout

在App Router中，Layout组件使用`layout.tsx`文件定义：

```tsx
// src/app/layout.tsx
import type { Metadata } from 'next'
import './globals.css'

export const metadata: Metadata = {
  title: 'My Next.js App',
  description: 'A Next.js application',
}

export default function RootLayout({
  children,
}: {
  children: React.ReactNode
}) {
  return (
    <html lang="en">
      <body>
        <header>
          <nav>
            <ul>
              <li><a href="/">Home</a></li>
              <li><a href="/about">About</a></li>
            </ul>
          </nav>
        </header>
        <main>{children}</main>
        <footer>
          <p>© 2024 My Next.js App</p>
        </footer>
      </body>
    </html>
  )
}
```

### 6.3 嵌套Layout

App Router支持嵌套Layout，可以在不同目录下定义Layout组件：

```
src/app/
├── layout.tsx          # 根Layout
├── page.tsx           # 首页
└── dashboard/
    ├── layout.tsx     # 仪表板Layout
    ├── page.tsx       # 仪表板首页
    └── settings/
        ├── layout.tsx # 设置页面Layout
        └── page.tsx   # 设置页面
```

嵌套Layout会自动继承父Layout的内容：

```tsx
// src/app/dashboard/layout.tsx
export default function DashboardLayout({
  children,
}: {
  children: React.ReactNode
}) {
  return (
    <div className="dashboard">
      <aside>
        <nav>
          <ul>
            <li><a href="/dashboard">Dashboard</a></li>
            <li><a href="/dashboard/settings">Settings</a></li>
          </ul>
        </nav>
      </aside>
      <section>{children}</section>
    </div>
  )
}
```

## 七、总结

本章节我们学习了Next.js的基础功能：

1. **Link组件**：客户端导航，支持预取、动态路由等特性
2. **Image组件**：图像优化，支持自动优化、懒加载、响应式图像等
3. **Script组件**：脚本优化，支持多种加载策略、内联脚本、脚本事件等
4. **Head组件与元数据**：App Router中的静态和动态元数据，Pages Router中的Head组件
5. **Font组件**：字体优化，支持Google Fonts和自定义字体
6. **Layout组件**：页面布局，支持嵌套Layout

这些基础功能是使用Next.js构建Web应用的核心，掌握这些功能将帮助你构建高性能、现代化的Next.js应用。在接下来的章节中，我们将深入学习Next.js的样式处理，包括CSS Modules、Tailwind CSS、CSS-in-JS等。

## 八、练习

1. 创建一个Next.js项目，使用Link组件实现导航
2. 使用Image组件优化图像，包括响应式图像和外部图像
3. 使用Script组件加载第三方脚本，尝试不同的加载策略
4. 配置元数据，包括静态元数据和动态元数据
5. 使用Font组件加载Google Fonts和自定义字体
6. 创建嵌套Layout，实现复杂的页面结构
7. 比较Next.js组件与原生HTML标签的区别，理解Next.js的优化特性

---

**下一章预告**：Next.js样式处理

在接下来的章节中，我们将深入学习Next.js的样式处理，包括CSS Modules、Tailwind CSS、CSS-in-JS等样式方案。
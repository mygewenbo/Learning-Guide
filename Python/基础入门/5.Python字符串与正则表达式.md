# Python字符串与正则表达式

## 一、字符串概述

字符串是Python中最常用的数据类型之一，用于表示文本数据。字符串是由字符组成的不可变序列，可以使用单引号、双引号或三引号定义。

```python
# 使用单引号定义字符串
str1 = 'Hello, World!'

# 使用双引号定义字符串
str2 = "Hello, World!"

# 使用三引号定义多行字符串
str3 = '''Hello,
World!'''

# 使用三引号定义多行字符串（双引号）
str4 = """Hello,
World!"""
```

## 二、字符串操作

### 2.1 字符串索引与切片

字符串是有序序列，可以通过索引访问单个字符，通过切片访问子字符串。

#### 2.1.1 字符串索引

字符串的索引从0开始，可以使用正数索引从左到右访问，也可以使用负数索引从右到左访问。

```python
str = "Hello, World!"

# 正数索引
print(str[0])  # 输出：H
print(str[1])  # 输出：e
print(str[6])  # 输出： 
print(str[7])  # 输出：W

# 负数索引
print(str[-1])  # 输出：!
print(str[-2])  # 输出：d
print(str[-7])  # 输出： 
print(str[-8])  # 输出：,
```

#### 2.1.2 字符串切片

字符串切片用于获取子字符串，语法为：`str[start:end:step]`

- `start`：起始索引（包含），默认为0
- `end`：结束索引（不包含），默认为字符串长度
- `step`：步长，默认为1

```python
str = "Hello, World!"

# 获取从索引0到索引5的子字符串（不包含索引5）
print(str[0:5])  # 输出：Hello

# 获取从索引7到末尾的子字符串
print(str[7:])  # 输出：World!

# 获取从开头到索引5的子字符串
print(str[:5])  # 输出：Hello

# 获取从索引0到索引12，步长为2的子字符串
print(str[0:12:2])  # 输出：Hlo ol

# 反转字符串
print(str[::-1])  # 输出：!dlroW ,olleH

# 获取最后5个字符
print(str[-5:])  # 输出：orld!
```

### 2.2 字符串拼接与重复

#### 2.2.1 字符串拼接

使用`+`运算符可以拼接字符串。

```python
str1 = "Hello"
str2 = "World"

# 拼接字符串
str3 = str1 + ", " + str2 + "!"
print(str3)  # 输出：Hello, World!
```

#### 2.2.2 字符串重复

使用`*`运算符可以重复字符串。

```python
str1 = "Hello"

# 重复字符串
str2 = str1 * 3
print(str2)  # 输出：HelloHelloHello
```

### 2.3 字符串长度

使用`len()`函数可以获取字符串的长度。

```python
str = "Hello, World!"
print(len(str))  # 输出：13
```

### 2.4 字符串查找

#### 2.4.1 `find()`方法

返回子字符串在字符串中首次出现的索引，如果没有找到则返回-1。

```python
str = "Hello, World!"

# 查找子字符串
print(str.find("World"))  # 输出：7
print(str.find("Python"))  # 输出：-1

# 从指定索引开始查找
print(str.find("l", 3))  # 输出：3

# 从指定索引开始到指定索引结束查找
print(str.find("l", 3, 5))  # 输出：3
```

#### 2.4.2 `index()`方法

返回子字符串在字符串中首次出现的索引，如果没有找到则抛出`ValueError`异常。

```python
str = "Hello, World!"

# 查找子字符串
print(str.index("World"))  # 输出：7
# print(str.index("Python"))  # 抛出ValueError异常
```

#### 2.4.3 `rfind()`和`rindex()`方法

`rfind()`方法返回子字符串在字符串中最后一次出现的索引，如果没有找到则返回-1。
`rindex()`方法返回子字符串在字符串中最后一次出现的索引，如果没有找到则抛出`ValueError`异常。

```python
str = "Hello, World! Hello, Python!"

# 查找子字符串最后一次出现的位置
print(str.rfind("Hello"))  # 输出：14
print(str.rindex("Hello"))  # 输出：14
```

### 2.5 字符串替换

使用`replace()`方法可以替换字符串中的子字符串。

```python
str = "Hello, World!"

# 替换子字符串
new_str = str.replace("World", "Python")
print(new_str)  # 输出：Hello, Python!

# 替换指定次数
str = "Hello, World! Hello, World! Hello, World!"
new_str = str.replace("World", "Python", 2)
print(new_str)  # 输出：Hello, Python! Hello, Python! Hello, World!
```

### 2.6 字符串分割

#### 2.6.1 `split()`方法

将字符串按照指定的分隔符分割成列表，默认分隔符为空格。

```python
str = "Hello, World! Hello, Python!"

# 按照空格分割
print(str.split())  # 输出：['Hello,', 'World!', 'Hello,', 'Python!']

# 按照逗号分割
print(str.split(","))  # 输出：['Hello', ' World! Hello', ' Python!']

# 按照逗号分割，指定分割次数
print(str.split(",", 1))  # 输出：['Hello', ' World! Hello, Python!']
```

#### 2.6.2 `splitlines()`方法

将字符串按照换行符分割成列表。

```python
str = "Hello\nWorld\nPython"

# 按照换行符分割
print(str.splitlines())  # 输出：['Hello', 'World', 'Python']

# 保留换行符
print(str.splitlines(True))  # 输出：['Hello\n', 'World\n', 'Python']
```

#### 2.6.3 `rsplit()`方法

从右向左按照指定的分隔符分割字符串。

```python
str = "Hello, World! Hello, Python!"

# 从右向左按照逗号分割，指定分割次数
print(str.rsplit(",", 1))  # 输出：['Hello, World! Hello', ' Python!']
```

### 2.7 字符串连接

使用`join()`方法可以将列表中的字符串连接成一个字符串。

```python
# 连接列表中的字符串
words = ["Hello", "World", "Python"]
str = ", ".join(words)
print(str)  # 输出：Hello, World, Python

# 连接元组中的字符串
words_tuple = ("Hello", "World", "Python")
str = "-".join(words_tuple)
print(str)  # 输出：Hello-World-Python

# 连接集合中的字符串
words_set = {"Hello", "World", "Python"}
str = " ".join(words_set)
print(str)  # 输出：Hello World Python（集合是无序的，输出顺序可能不同）
```

### 2.8 字符串大小写转换

#### 2.8.1 `lower()`方法

将字符串转换为小写。

```python
str = "Hello, World!"
print(str.lower())  # 输出：hello, world!
```

#### 2.8.2 `upper()`方法

将字符串转换为大写。

```python
str = "Hello, World!"
print(str.upper())  # 输出：HELLO, WORLD!
```

#### 2.8.3 `title()`方法

将字符串中每个单词的首字母转换为大写，其余字母转换为小写。

```python
str = "hello, world!"
print(str.title())  # 输出：Hello, World!
```

#### 2.8.4 `capitalize()`方法

将字符串的第一个字符转换为大写，其余字符转换为小写。

```python
str = "hello, world!"
print(str.capitalize())  # 输出：Hello, world!
```

#### 2.8.5 `swapcase()`方法

将字符串中的大写字母转换为小写，小写字母转换为大写。

```python
str = "Hello, World!"
print(str.swapcase())  # 输出：hELLO, wORLD!
```

### 2.9 字符串去除空白

#### 2.9.1 `strip()`方法

去除字符串两端的空白字符（空格、制表符、换行符等）。

```python
str = "   Hello, World!   \n"
print(str.strip())  # 输出：Hello, World!

# 去除字符串两端的指定字符
str = "###Hello, World!###"
print(str.strip("#"))  # 输出：Hello, World!
```

#### 2.9.2 `lstrip()`方法

去除字符串左侧的空白字符。

```python
str = "   Hello, World!   \n"
print(str.lstrip())  # 输出：Hello, World!   \n
# 去除字符串左侧的指定字符
str = "###Hello, World!###"
print(str.lstrip("#"))  # 输出：Hello, World!###
```

#### 2.9.3 `rstrip()`方法

去除字符串右侧的空白字符。

```python
str = "   Hello, World!   \n"
print(str.rstrip())  # 输出：   Hello, World!

# 去除字符串右侧的指定字符
str = "###Hello, World!###"
print(str.rstrip("#"))  # 输出：###Hello, World!
```

### 2.10 字符串判断

#### 2.10.1 `startswith()`方法

判断字符串是否以指定的前缀开头。

```python
str = "Hello, World!"

print(str.startswith("Hello"))  # 输出：True
print(str.startswith("World"))  # 输出：False

# 从指定索引开始判断
print(str.startswith("World", 7))  # 输出：True
```

#### 2.10.2 `endswith()`方法

判断字符串是否以指定的后缀结尾。

```python
str = "Hello, World!"

print(str.endswith("!"))  # 输出：True
print(str.endswith("World"))  # 输出：False

# 从指定索引范围判断
print(str.endswith("World", 0, 12))  # 输出：True
```

#### 2.10.3 `isalpha()`方法

判断字符串是否只包含字母。

```python
print("Hello".isalpha())  # 输出：True
print("Hello123".isalpha())  # 输出：False
print("Hello World".isalpha())  # 输出：False（包含空格）
```

#### 2.10.4 `isdigit()`方法

判断字符串是否只包含数字。

```python
print("123".isdigit())  # 输出：True
print("123abc".isdigit())  # 输出：False
print("123.45".isdigit())  # 输出：False（包含小数点）
```

#### 2.10.5 `isalnum()`方法

判断字符串是否只包含字母和数字。

```python
print("Hello123".isalnum())  # 输出：True
print("Hello 123".isalnum())  # 输出：False（包含空格）
print("Hello@123".isalnum())  # 输出：False（包含@符号）
```

#### 2.10.6 `isspace()`方法

判断字符串是否只包含空白字符。

```python
print("   ".isspace())  # 输出：True
print("  \t\n".isspace())  # 输出：True
print("   Hello   ".isspace())  # 输出：False（包含非空白字符）
```

#### 2.10.7 `islower()`方法

判断字符串是否全为小写。

```python
print("hello".islower())  # 输出：True
print("Hello".islower())  # 输出：False
```

#### 2.10.8 `isupper()`方法

判断字符串是否全为大写。

```python
print("HELLO".isupper())  # 输出：True
print("Hello".isupper())  # 输出：False
```

#### 2.10.9 `istitle()`方法

判断字符串是否符合标题格式（每个单词首字母大写，其余字母小写）。

```python
print("Hello, World!".istitle())  # 输出：True
print("hello, World!".istitle())  # 输出：False
```

### 2.11 字符串替换与填充

#### 2.11.1 `center()`方法

将字符串居中，并使用指定的字符填充两侧。

```python
str = "Hello"

# 居中，总长度为10，使用空格填充
print(str.center(10))  # 输出：  Hello   

# 居中，总长度为10，使用*填充
print(str.center(10, "*"))  # 输出：**Hello***
```

#### 2.11.2 `ljust()`方法

将字符串左对齐，并使用指定的字符填充右侧。

```python
str = "Hello"

# 左对齐，总长度为10，使用空格填充
print(str.ljust(10))  # 输出：Hello     

# 左对齐，总长度为10，使用*填充
print(str.ljust(10, "*"))  # 输出：Hello*****
```

#### 2.11.3 `rjust()`方法

将字符串右对齐，并使用指定的字符填充左侧。

```python
str = "Hello"

# 右对齐，总长度为10，使用空格填充
print(str.rjust(10))  # 输出：     Hello

# 右对齐，总长度为10，使用*填充
print(str.rjust(10, "*"))  # 输出：*****Hello
```

#### 2.11.4 `zfill()`方法

将字符串右对齐，并在左侧填充0。

```python
str = "42"
print(str.zfill(5))  # 输出：00042

str = "-42"
print(str.zfill(5))  # 输出：-0042
```

## 三、字符串格式化

字符串格式化用于将变量插入到字符串中，Python提供了多种字符串格式化方式。

### 3.1 格式化字符串字面值（f-strings）

f-strings是Python 3.6+引入的字符串格式化方式，使用`f`或`F`前缀，在字符串中使用`{}`包裹变量或表达式。

#### 3.1.1 基本用法

```python
name = "Alice"
age = 25

# 基本用法
print(f"My name is {name}, and I am {age} years old.")  # 输出：My name is Alice, and I am 25 years old.

# 在{}中使用表达式
print(f"Next year I will be {age + 1} years old.")  # 输出：Next year I will be 26 years old.

# 在{}中使用函数调用
print(f"My name in uppercase is {name.upper()}.")  # 输出：My name in uppercase is ALICE.
```

#### 3.1.2 格式说明符

可以在`{}`中使用格式说明符，格式为：`{变量:格式说明符}`

```python
# 整数格式化
number = 42
print(f"Number: {number:d}")  # 输出：Number: 42

# 浮点数格式化
pi = 3.1415926535
print(f"Pi: {pi:.2f}")  # 输出：Pi: 3.14（保留2位小数）
print(f"Pi: {pi:.5f}")  # 输出：Pi: 3.14159（保留5位小数）

# 宽度和对齐
name = "Alice"
print(f"Name: {name:<10}")  # 输出：Name: Alice     （左对齐，宽度10）
print(f"Name: {name:>10}")  # 输出：Name:     Alice（右对齐，宽度10）
print(f"Name: {name:^10}")  # 输出：Name:   Alice  （居中，宽度10）

# 使用填充字符
print(f"Name: {name:*<10}")  # 输出：Name: Alice*****（左对齐，宽度10，*填充）
print(f"Name: {name:*>10}")  # 输出：Name: *****Alice（右对齐，宽度10，*填充）
print(f"Name: {name:*^10}")  # 输出：Name: **Alice***（居中，宽度10，*填充）

# 千位分隔符
number = 1000000
print(f"Number: {number:,}")  # 输出：Number: 1,000,000

# 百分比格式化
percentage = 0.75
print(f"Percentage: {percentage:.2%}")  # 输出：Percentage: 75.00%
```

### 3.2 `str.format()`方法

`str.format()`方法是Python 3.0+引入的字符串格式化方式，使用`{}`作为占位符。

#### 3.2.1 基本用法

```python
name = "Alice"
age = 25

# 基本用法
print("My name is {}, and I am {} years old.".format(name, age))  # 输出：My name is Alice, and I am 25 years old.

# 使用位置参数
print("My name is {0}, and I am {1} years old. {0} is a good name.".format(name, age))  # 输出：My name is Alice, and I am 25 years old. Alice is a good name.

# 使用关键字参数
print("My name is {name}, and I am {age} years old.".format(name=name, age=age))  # 输出：My name is Alice, and I am 25 years old.

# 混合使用位置参数和关键字参数
print("My name is {0}, and I am {age} years old.".format(name, age=age))  # 输出：My name is Alice, and I am 25 years old.
```

#### 3.2.2 格式说明符

```python
# 整数格式化
number = 42
print("Number: {:d}".format(number))  # 输出：Number: 42

# 浮点数格式化
pi = 3.1415926535
print("Pi: {:.2f}".format(pi))  # 输出：Pi: 3.14（保留2位小数）

# 宽度和对齐
name = "Alice"
print("Name: {:<10}".format(name))  # 输出：Name: Alice     （左对齐，宽度10）
print("Name: {:>10}".format(name))  # 输出：Name:     Alice（右对齐，宽度10）
print("Name: {:^10}".format(name))  # 输出：Name:   Alice  （居中，宽度10）

# 使用填充字符
print("Name: {:*<10}".format(name))  # 输出：Name: Alice*****（左对齐，宽度10，*填充）
```

### 3.3 字符串格式化操作符（%）

字符串格式化操作符`%`是Python早期的字符串格式化方式，类似于C语言的`printf`函数。

#### 3.3.1 基本用法

```python
name = "Alice"
age = 25

# 基本用法
print("My name is %s, and I am %d years old." % (name, age))  # 输出：My name is Alice, and I am 25 years old.

# 浮点数格式化
pi = 3.1415926535
print("Pi: %.2f" % pi)  # 输出：Pi: 3.14（保留2位小数）

# 宽度和对齐
name = "Alice"
print("Name: %-10s" % name)  # 输出：Name: Alice     （左对齐，宽度10）
print("Name: %10s" % name)  # 输出：Name:     Alice（右对齐，宽度10）
```

#### 3.3.2 常用格式说明符

| 格式说明符 | 描述 |
|------------|------|
| `%s` | 字符串 |
| `%d` | 十进制整数 |
| `%f` | 浮点数 |
| `%e` | 科学计数法 |
| `%x` | 十六进制整数（小写） |
| `%X` | 十六进制整数（大写） |
| `%o` | 八进制整数 |
| `%%` | 百分号 |

### 3.4 `str.format_map()`方法

`str.format_map()`方法与`str.format()`类似，但接收一个映射对象（如字典）作为参数。

```python
person = {
    "name": "Alice",
    "age": 25,
    "city": "New York"
}

print("My name is {name}, and I am {age} years old. I live in {city}.".format_map(person))  # 输出：My name is Alice, and I am 25 years old. I live in New York.
```

## 四、正则表达式基础

正则表达式是一种用于匹配字符串中字符组合的模式，在Python中使用`re`模块实现。

### 4.1 正则表达式语法

#### 4.1.1 字符匹配

| 字符 | 描述 |
|------|------|
| `.` | 匹配任意单个字符，除了换行符 |
| `[]` | 匹配括号内的任意一个字符 |
| `[^]` | 匹配括号外的任意一个字符 |
| `\d` | 匹配任意数字，等价于`[0-9]` |
| `\D` | 匹配任意非数字，等价于`[^0-9]` |
| `\w` | 匹配任意字母、数字或下划线，等价于`[a-zA-Z0-9_]` |
| `\W` | 匹配任意非字母、数字或下划线，等价于`[^a-zA-Z0-9_]` |
| `\s` | 匹配任意空白字符，包括空格、制表符、换行符等 |
| `\S` | 匹配任意非空白字符 |

#### 4.1.2 重复匹配

| 字符 | 描述 |
|------|------|
| `*` | 匹配前面的字符0次或多次 |
| `+` | 匹配前面的字符1次或多次 |
| `?` | 匹配前面的字符0次或1次 |
| `{n}` | 匹配前面的字符n次 |
| `{n,}` | 匹配前面的字符至少n次 |
| `{n,m}` | 匹配前面的字符n到m次 |

#### 4.1.3 边界匹配

| 字符 | 描述 |
|------|------|
| `^` | 匹配字符串的开头 |
| `$` | 匹配字符串的结尾 |
| `\b` | 匹配单词边界 |
| `\B` | 匹配非单词边界 |

#### 4.1.4 分组与捕获

| 字符 | 描述 |
|------|------|
| `()` | 分组，将括号内的内容作为一个整体 |
| `\1`, `\2`, ... | 反向引用，引用前面的分组 |

#### 4.1.5 逻辑或

| 字符 | 描述 |
|------|------|
| `|` | 逻辑或，匹配左边或右边的表达式 |

#### 4.1.6 转义字符

使用`\`转义特殊字符，如`\.`匹配点号，`\*`匹配星号等。

### 4.2 正则表达式示例

```python
# 匹配邮箱地址
email_pattern = r"^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$"

# 匹配手机号码（中国大陆）
phone_pattern = r"^1[3-9]\d{9}$"

# 匹配URL
url_pattern = r"^https?://[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}(/[a-zA-Z0-9._%+-]*)*(/)?(\?[a-zA-Z0-9._%+-]+=[a-zA-Z0-9._%+-]*(&[a-zA-Z0-9._%+-]+=[a-zA-Z0-9._%+-]*)*)?$"

# 匹配IP地址
ip_pattern = r"^((25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(25[0-5]|2[0-4]\d|[01]?\d\d?)$"
```

## 五、re模块的使用

Python的`re`模块提供了正则表达式的支持，包括编译正则表达式、匹配、搜索、替换等功能。

### 5.1 编译正则表达式

使用`re.compile()`函数可以编译正则表达式，返回一个正则表达式对象，提高匹配效率。

```python
import re

# 编译正则表达式
pattern = re.compile(r"^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$")

# 使用编译后的正则表达式对象
email = "alice@example.com"
if pattern.match(email):
    print("Valid email address")
else:
    print("Invalid email address")
```

### 5.2 匹配函数

#### 5.2.1 `re.match()`函数

`re.match()`函数从字符串的开头开始匹配，如果匹配成功则返回一个匹配对象，否则返回`None`。

```python
import re

# 匹配字符串开头
result = re.match(r"Hello", "Hello, World!")
if result:
    print("Match found:", result.group())  # 输出：Match found: Hello
else:
    print("No match")

# 匹配失败
result = re.match(r"World", "Hello, World!")
if result:
    print("Match found:", result.group())
else:
    print("No match")  # 输出：No match
```

#### 5.2.2 `re.search()`函数

`re.search()`函数在整个字符串中搜索匹配项，如果匹配成功则返回一个匹配对象，否则返回`None`。

```python
import re

# 搜索字符串中的匹配项
result = re.search(r"World", "Hello, World!")
if result:
    print("Match found:", result.group())  # 输出：Match found: World
    print("Start position:", result.start())  # 输出：Start position: 7
    print("End position:", result.end())  # 输出：End position: 12
    print("Span:", result.span())  # 输出：Span: (7, 12)
else:
    print("No match")
```

#### 5.2.3 `re.findall()`函数

`re.findall()`函数返回字符串中所有匹配项的列表。

```python
import re

# 查找所有数字
result = re.findall(r"\d+", "There are 123 apples and 456 oranges.")
print(result)  # 输出：['123', '456']

# 查找所有单词
result = re.findall(r"\w+", "Hello, World! How are you?")
print(result)  # 输出：['Hello', 'World', 'How', 'are', 'you']
```

#### 5.2.4 `re.finditer()`函数

`re.finditer()`函数返回一个迭代器，包含字符串中所有匹配项的匹配对象。

```python
import re

# 查找所有数字
result = re.finditer(r"\d+", "There are 123 apples and 456 oranges.")
for match in result:
    print("Match found:", match.group(), "at position:", match.span())
# 输出：
# Match found: 123 at position: (10, 13)
# Match found: 456 at position: (21, 24)
```

#### 5.2.5 `re.split()`函数

`re.split()`函数使用正则表达式分割字符串，返回一个列表。

```python
import re

# 使用正则表达式分割字符串
result = re.split(r"[,\s]+", "Hello, World! How are you?")
print(result)  # 输出：['Hello', 'World!', 'How', 'are', 'you?']

# 指定分割次数
result = re.split(r"[,\s]+", "Hello, World! How are you?", maxsplit=2)
print(result)  # 输出：['Hello', 'World!', 'How are you?']
```

#### 5.2.6 `re.sub()`函数

`re.sub()`函数使用正则表达式替换字符串中的匹配项，返回替换后的字符串。

```python
import re

# 替换字符串中的数字
result = re.sub(r"\d+", "[NUMBER]", "There are 123 apples and 456 oranges.")
print(result)  # 输出：There are [NUMBER] apples and [NUMBER] oranges.

# 指定替换次数
result = re.sub(r"\d+", "[NUMBER]", "There are 123 apples and 456 oranges.", count=1)
print(result)  # 输出：There are [NUMBER] apples and 456 oranges.

# 使用函数替换
def replace_func(match):
    return f"[{match.group().upper()}]"

result = re.sub(r"\w+", replace_func, "Hello, World!")
print(result)  # 输出：[HELLO], [WORLD]!
```

#### 5.2.7 `re.subn()`函数

`re.subn()`函数与`re.sub()`类似，但返回一个元组，包含替换后的字符串和替换次数。

```python
import re

# 替换字符串中的数字
result = re.subn(r"\d+", "[NUMBER]", "There are 123 apples and 456 oranges.")
print(result)  # 输出：('There are [NUMBER] apples and [NUMBER] oranges.', 2)
print("Replaced string:", result[0])  # 输出：Replaced string: There are [NUMBER] apples and [NUMBER] oranges.
print("Number of replacements:", result[1])  # 输出：Number of replacements: 2
```

### 5.3 匹配对象

匹配成功后返回的匹配对象包含了匹配的信息，如匹配的字符串、起始位置、结束位置等。

| 方法/属性 | 描述 |
|-----------|------|
| `group()` | 返回匹配的字符串 |
| `group(n)` | 返回第n个分组匹配的字符串 |
| `groups()` | 返回所有分组匹配的字符串组成的元组 |
| `groupdict()` | 返回所有命名分组匹配的字符串组成的字典 |
| `start()` | 返回匹配的起始位置 |
| `end()` | 返回匹配的结束位置 |
| `span()` | 返回匹配的起始和结束位置组成的元组 |

#### 5.3.1 示例

```python
import re

# 匹配邮箱地址，提取用户名和域名
pattern = re.compile(r"^([a-zA-Z0-9._%+-]+)@([a-zA-Z0-9.-]+)\.([a-zA-Z]{2,})$"

email = "alice@example.com"
result = pattern.match(email)
if result:
    print("Full match:", result.group())  # 输出：Full match: alice@example.com
    print("Username:", result.group(1))  # 输出：Username: alice
    print("Domain:", result.group(2))  # 输出：Domain: example
    print("Top-level domain:", result.group(3))  # 输出：Top-level domain: com
    print("All groups:", result.groups())  # 输出：All groups: ('alice', 'example', 'com')
```

#### 5.3.2 命名分组

使用`(?P<name>...)`语法可以创建命名分组，方便通过名称访问分组匹配的字符串。

```python
import re

# 使用命名分组
pattern = re.compile(r"^(?P<username>[a-zA-Z0-9._%+-]+)@(?P<domain>[a-zA-Z0-9.-]+)\.(?P<tld>[a-zA-Z]{2,})$"

email = "alice@example.com"
result = pattern.match(email)
if result:
    print("Username:", result.group("username"))  # 输出：Username: alice
    print("Domain:", result.group("domain"))  # 输出：Domain: example
    print("Top-level domain:", result.group("tld"))  # 输出：Top-level domain: com
    print("Group dict:", result.groupdict())  # 输出：Group dict: {'username': 'alice', 'domain': 'example', 'tld': 'com'}
```

### 5.4 正则表达式标志

正则表达式标志用于修改正则表达式的匹配行为，常用的标志包括：

| 标志 | 描述 |
|------|------|
| `re.I` 或 `re.IGNORECASE` | 忽略大小写 |
| `re.M` 或 `re.MULTILINE` | 多行模式，`^`和`$`匹配每行的开头和结尾 |
| `re.S` 或 `re.DOTALL` | 点号匹配所有字符，包括换行符 |
| `re.X` 或 `re.VERBOSE` | 允许正则表达式中包含注释和空白字符，提高可读性 |
| `re.A` 或 `re.ASCII` | `\w`、`\d`、`\s`等只匹配ASCII字符 |

#### 5.4.1 示例

```python
import re

# 忽略大小写
result = re.match(r"hello", "Hello, World!", re.I)
if result:
    print("Match found:", result.group())  # 输出：Match found: Hello

# 多行模式
text = "Line 1\nLine 2\nLine 3"
result = re.findall(r"^Line", text, re.M)
print(result)  # 输出：['Line', 'Line', 'Line']

# 点号匹配所有字符
text = "Hello\nWorld"
result = re.match(r"Hello.World", text, re.S)
if result:
    print("Match found:", result.group())  # 输出：Match found: Hello\nWorld

# 详细模式
pattern = re.compile(r"""^\s*          # 匹配开头的空白字符
                     ([a-zA-Z0-9._%+-]+)  # 匹配用户名
                     @                    # 匹配@符号
                     ([a-zA-Z0-9.-]+)     # 匹配域名
                     \.                   # 匹配点号
                     ([a-zA-Z]{2,})       # 匹配顶级域名
                     \s*$                # 匹配结尾的空白字符
                     """, re.VERBOSE)

email = "  alice@example.com  "
result = pattern.match(email)
if result:
    print("Valid email address")  # 输出：Valid email address
```

## 六、综合示例

### 6.1 验证邮箱地址

```python
import re

def is_valid_email(email):
    """验证邮箱地址是否有效
    
    参数：
        email: 要验证的邮箱地址
    
    返回值：
        如果邮箱地址有效，返回True；否则，返回False
    """
    pattern = re.compile(r"^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$"
    return bool(pattern.match(email))

# 测试邮箱地址验证
emails = [
    "alice@example.com",
    "bob.123@example.co.uk",
    "charlie+tag@example.org",
    "invalid-email",
    "invalid@email",
    "invalid@email..com"
]

for email in emails:
    if is_valid_email(email):
        print(f"{email} is valid")
    else:
        print(f"{email} is invalid")
```

### 6.2 提取文本中的电话号码

```python
import re

def extract_phone_numbers(text):
    """提取文本中的电话号码
    
    参数：
        text: 要提取电话号码的文本
    
    返回值：
        提取到的电话号码列表
    """
    pattern = re.compile(r"1[3-9]\d{9}")
    return pattern.findall(text)

# 测试电话号码提取
text = "联系电话：13812345678，或者拨打13987654321，也可以发送邮件到alice@example.com"
phone_numbers = extract_phone_numbers(text)
print("提取到的电话号码：", phone_numbers)  # 输出：提取到的电话号码： ['13812345678', '13987654321']
```

### 6.3 替换文本中的敏感词

```python
import re

def censor_text(text, sensitive_words):
    """替换文本中的敏感词
    
    参数：
        text: 要处理的文本
        sensitive_words: 敏感词列表
    
    返回值：
        替换后的文本
    """
    # 构建正则表达式，匹配所有敏感词
    pattern = re.compile(r"|join(re.escape(word) for word in sensitive_words), re.I)
    # 替换敏感词为***
    return pattern.sub("***", text)

# 测试敏感词替换
sensitive_words = ["敏感词1", "敏感词2", "敏感词3"]
text = "这是一段包含敏感词1和敏感词2的文本，还有SensitiveWord3"
result = censor_text(text, sensitive_words)
print("替换后的文本：", result)  # 输出：替换后的文本： 这是一段包含***和***的文本，还有***
```

## 七、常见问题与解决方案

### 7.1 转义字符问题

- **问题**：正则表达式中包含特殊字符，需要转义
- **解决方案**：使用`re.escape()`函数自动转义特殊字符

```python
import re

# 转义特殊字符
pattern = re.escape(r"https://example.com")
print(pattern)  # 输出：https\:\/\/example\.com

# 直接使用特殊字符会导致匹配失败
text = "Visit https://example.com for more information"
result = re.search(r"https://example.com", text)
if result:
    print("Match found")  # 输出：Match found
else:
    print("No match")
```

### 7.2 贪婪匹配问题

- **问题**：正则表达式默认使用贪婪匹配，可能匹配过多的内容
- **解决方案**：在重复量词后添加`?`，使用非贪婪匹配

```python
import re

# 贪婪匹配
text = "<div>Content 1</div><div>Content 2</div>"
result = re.findall(r"<div>(.*)</div>", text)
print(result)  # 输出：['Content 1</div><div>Content 2']（贪婪匹配，匹配了整个字符串）

# 非贪婪匹配
result = re.findall(r"<div>(.*?)</div>", text)
print(result)  # 输出：['Content 1', 'Content 2']（非贪婪匹配，匹配了两个div标签）
```

### 7.3 性能问题

- **问题**：复杂的正则表达式可能导致性能问题
- **解决方案**：
  1. 编译正则表达式，提高匹配效率
  2. 优化正则表达式，避免回溯
  3. 对于简单的字符串操作，使用字符串方法代替正则表达式

```python
import re
import time

# 比较字符串方法和正则表达式的性能
text = "Hello, World!" * 1000000

# 使用字符串方法
start_time = time.time()
result = text.count("Hello")
end_time = time.time()
print(f"字符串方法耗时：{end_time - start_time:.6f}秒")

# 使用正则表达式
start_time = time.time()
pattern = re.compile(r"Hello")
result = len(pattern.findall(text))
end_time = time.time()
print(f"正则表达式耗时：{end_time - start_time:.6f}秒")
```

## 八、总结

本章介绍了Python字符串与正则表达式的相关知识，包括：

1. **字符串概述**：介绍了字符串的定义和基本特性
2. **字符串操作**：详细讲解了字符串的索引、切片、拼接、重复、长度、查找、替换、分割、连接、大小写转换、去除空白、判断和格式化等操作
3. **字符串格式化**：包括f-strings、`str.format()`方法、字符串格式化操作符和`str.format_map()`方法
4. **正则表达式基础**：介绍了正则表达式的语法和常见模式
5. **re模块的使用**：详细讲解了re模块的编译、匹配、搜索、替换等功能
6. **综合示例**：包括验证邮箱地址、提取电话号码和替换敏感词等示例
7. **常见问题与解决方案**：列出了转义字符问题、贪婪匹配问题和性能问题的解决方案

通过本章的学习，你应该已经掌握了Python字符串与正则表达式的相关知识，可以使用字符串操作和正则表达式处理文本数据了。接下来，我们将学习Python的文件操作。

## 九、练习

1. 编写一个Python程序，将字符串"Hello, World!"转换为大写、小写和标题格式。
2. 编写一个Python程序，去除字符串"   Hello, World!   \n"两端的空白字符。
3. 编写一个Python程序，使用f-strings格式化字符串，输出"My name is Alice, and I am 25 years old. I live in New York."。
4. 编写一个Python程序，使用正则表达式验证手机号码（中国大陆）。
5. 编写一个Python程序，使用正则表达式提取文本中的所有邮箱地址。
6. 编写一个Python程序，使用正则表达式替换文本中的所有数字为"[NUMBER]"。
7. 编写一个Python程序，使用正则表达式匹配URL。
8. 编写一个Python程序，使用正则表达式匹配IP地址。
9. 编写一个Python程序，使用正则表达式提取HTML标签中的内容。
10. 编写一个Python程序，使用正则表达式验证密码强度（至少包含8个字符，至少包含一个大写字母、一个小写字母、一个数字和一个特殊字符）。

## 十、参考资料

1. Python官方文档：https://docs.python.org/zh-cn/3/library/re.html
2. Python官方文档：https://docs.python.org/zh-cn/3/tutorial/introduction.html#strings
3. 正则表达式教程：https://regex101.com/
4. 《Python编程：从入门到实践》（Eric Matthes）
5. 《流畅的Python》（Luciano Ramalho）
# 3. 路径模块

## 3.1 path模块概述

path模块是Node.js的核心模块之一，用于处理文件和目录路径。它提供了一系列方法来处理不同操作系统的路径，确保路径在不同平台上的兼容性。

### 3.1.1 path模块的基本用法

```javascript
const path = require('node:path');
```

### 3.1.2 路径分隔符

不同操作系统使用不同的路径分隔符：
- **Windows**：使用反斜杠（`\`）作为路径分隔符
- **Linux/macOS**：使用正斜杠（`/`）作为路径分隔符

path模块提供了以下属性来获取路径分隔符：

```javascript
console.log('Path separator:', path.sep);
console.log('Directory separator:', path.delimiter);
```

## 3.2 路径拼接

路径拼接是path模块中最常用的功能之一，用于将多个路径片段拼接成一个完整的路径。

### 3.2.1 path.join()

`path.join()`方法用于拼接路径片段，并自动处理路径分隔符，确保在不同操作系统上的兼容性。

```javascript
const path = require('node:path');

// 拼接路径
const fullPath = path.join('/home', 'user', 'directory', 'file.txt');
console.log('Full path:', fullPath); // /home/user/directory/file.txt

// 处理相对路径
const relativePath = path.join('/home', 'user', '..', 'other', 'file.txt');
console.log('Relative path:', relativePath); // /home/other/file.txt

// 处理当前目录
const currentPath = path.join(__dirname, 'file.txt');
console.log('Current path:', currentPath); // 当前目录下的file.txt
```

### 3.2.2 path.resolve()

`path.resolve()`方法用于将路径片段解析为绝对路径，从当前工作目录开始解析。

```javascript
const path = require('node:path');

// 解析绝对路径
const absolutePath = path.resolve('directory', 'file.txt');
console.log('Absolute path:', absolutePath); // 当前工作目录/directory/file.txt

// 解析多个路径片段
const resolvedPath = path.resolve('/home', 'user', 'directory', 'file.txt');
console.log('Resolved path:', resolvedPath); // /home/user/directory/file.txt

// 处理相对路径
const relativeResolvedPath = path.resolve('/home', 'user', '..', 'other', 'file.txt');
console.log('Relative resolved path:', relativeResolvedPath); // /home/other/file.txt
```

## 3.3 路径解析

路径解析用于获取路径的各个组成部分，如目录名、文件名、扩展名等。

### 3.3.1 path.dirname()

`path.dirname()`方法用于获取路径的目录部分。

```javascript
const path = require('node:path');

const filePath = '/home/user/directory/file.txt';
console.log('Directory name:', path.dirname(filePath)); // /home/user/directory
```

### 3.3.2 path.basename()

`path.basename()`方法用于获取路径的基本名称，即文件名部分。

```javascript
const path = require('node:path');

const filePath = '/home/user/directory/file.txt';

// 获取完整文件名
console.log('Base name:', path.basename(filePath)); // file.txt

// 获取文件名（不包含扩展名）
console.log('Base name without extension:', path.basename(filePath, '.txt')); // file
```

### 3.3.3 path.extname()

`path.extname()`方法用于获取路径的扩展名。

```javascript
const path = require('node:path');

const filePath = '/home/user/directory/file.txt';
console.log('Extension:', path.extname(filePath)); // .txt

const imagePath = '/home/user/images/photo.jpg';
console.log('Image extension:', path.extname(imagePath)); // .jpg

const noExtPath = '/home/user/directory/file';
console.log('No extension:', path.extname(noExtPath)); // 空字符串
```

### 3.3.4 path.parse()

`path.parse()`方法用于将路径解析为一个对象，包含路径的各个组成部分。

```javascript
const path = require('node:path');

const filePath = '/home/user/directory/file.txt';
const parsedPath = path.parse(filePath);

console.log('Parsed path:', parsedPath);
/*
{
  root: '/',
  dir: '/home/user/directory',
  base: 'file.txt',
  ext: '.txt',
  name: 'file'
}
*/
```

### 3.3.5 path.format()

`path.format()`方法用于将路径对象格式化为字符串路径，是`path.parse()`的逆操作。

```javascript
const path = require('node:path');

const pathObj = {
  root: '/',
  dir: '/home/user/directory',
  base: 'file.txt',
  ext: '.txt',
  name: 'file'
};

const formattedPath = path.format(pathObj);
console.log('Formatted path:', formattedPath); // /home/user/directory/file.txt
```

## 3.4 路径规范化

路径规范化用于处理路径中的冗余部分，如`..`、`.`等，确保路径的一致性。

### 3.4.1 path.normalize()

`path.normalize()`方法用于规范化路径，处理路径中的冗余部分。

```javascript
const path = require('node:path');

// 规范化路径
const normalizedPath = path.normalize('/home/user/../directory/./file.txt');
console.log('Normalized path:', normalizedPath); // /home/directory/file.txt

// 处理多个斜杠
const multipleSlashesPath = path.normalize('/home//user//directory//file.txt');
console.log('Multiple slashes path:', multipleSlashesPath); // /home/user/directory/file.txt
```

## 3.5 路径比较

### 3.5.1 path.relative()

`path.relative()`方法用于获取从一个路径到另一个路径的相对路径。

```javascript
const path = require('node:path');

const from = '/home/user/directory';
const to = '/home/user/other/file.txt';

const relativePath = path.relative(from, to);
console.log('Relative path:', relativePath); // ../other/file.txt
```

### 3.5.2 path.isAbsolute()

`path.isAbsolute()`方法用于判断一个路径是否为绝对路径。

```javascript
const path = require('node:path');

console.log('Is absolute:', path.isAbsolute('/home/user/file.txt')); // true
console.log('Is absolute:', path.isAbsolute('relative/path')); // false
console.log('Is absolute:', path.isAbsolute('.')); // false
console.log('Is absolute:', path.isAbsolute('..')); // false
```

## 3.6 其他常用方法

### 3.6.1 path.sep

`path.sep`属性用于获取当前操作系统的路径分隔符。

```javascript
const path = require('node:path');

console.log('Path separator:', path.sep); // Windows: \, Linux/macOS: /
```

### 3.6.2 path.delimiter

`path.delimiter`属性用于获取当前操作系统的环境变量分隔符。

```javascript
const path = require('node:path');

console.log('Path delimiter:', path.delimiter); // Windows: ;, Linux/macOS: :
```

### 3.6.3 path.posix

`path.posix`属性提供了POSIX特定的路径方法，无论当前操作系统是什么，都使用正斜杠作为路径分隔符。

```javascript
const path = require('node:path');

console.log('POSIX join:', path.posix.join('/home', 'user', 'file.txt')); // /home/user/file.txt
```

### 3.6.4 path.win32

`path.win32`属性提供了Windows特定的路径方法，无论当前操作系统是什么，都使用反斜杠作为路径分隔符。

```javascript
const path = require('node:path');

console.log('Win32 join:', path.win32.join('C:\\home', 'user', 'file.txt')); // C:\home\user\file.txt
```

## 3.7 最佳实践

### 3.7.1 优先使用path模块处理路径

始终使用path模块处理路径，而不是手动拼接字符串，确保在不同操作系统上的兼容性。

```javascript
// 推荐
const fullPath = path.join(__dirname, 'directory', 'file.txt');

// 不推荐
const fullPath = __dirname + '/directory/file.txt';
```

### 3.7.2 使用__dirname和__filename

使用`__dirname`和`__filename`获取当前模块的目录和文件名，避免使用相对路径。

```javascript
const path = require('node:path');

// 获取当前模块的目录
console.log('Current directory:', __dirname);

// 获取当前模块的文件名
console.log('Current filename:', __filename);

// 拼接路径
const filePath = path.join(__dirname, 'file.txt');
console.log('File path:', filePath);
```

### 3.7.3 处理不同操作系统的路径

使用path模块的方法处理不同操作系统的路径，确保路径在不同平台上的兼容性。

```javascript
const path = require('node:path');

// 在Windows上，path.join会自动使用反斜杠
const windowsPath = path.join('C:', 'home', 'user', 'file.txt');
console.log('Windows path:', windowsPath); // C:\home\user\file.txt

// 在Linux/macOS上，path.join会自动使用正斜杠
const linuxPath = path.join('/home', 'user', 'file.txt');
console.log('Linux path:', linuxPath); // /home/user/file.txt
```

### 3.7.4 规范化路径

在处理用户输入的路径时，使用`path.normalize()`方法规范化路径，避免路径遍历攻击。

```javascript
const path = require('node:path');

const userInput = '../../../../etc/passwd';
const normalizedPath = path.normalize(userInput);
console.log('Normalized path:', normalizedPath); // ../../../../etc/passwd

// 更安全的做法是将用户输入限制在特定目录下
const baseDir = '/home/user';
const safePath = path.resolve(baseDir, userInput);
console.log('Safe path:', safePath); // /home/etc/passwd
```

## 3.8 实践练习

1. 使用path模块拼接不同的路径片段，处理相对路径和绝对路径
2. 使用path模块解析路径，获取路径的各个组成部分
3. 使用path模块规范化路径，处理路径中的冗余部分
4. 使用path模块获取从一个路径到另一个路径的相对路径
5. 使用path模块判断一个路径是否为绝对路径
6. 实现一个函数，获取文件的扩展名
7. 实现一个函数，获取文件的名称（不包含扩展名）
8. 实现一个函数，判断两个路径是否指向同一个文件

通过以上练习，你将掌握Node.js路径模块的核心概念和使用方法，能够编写跨平台兼容的路径处理代码。
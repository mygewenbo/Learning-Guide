# Next.js 实战项目 - 项目实现

## 一、项目初始化

### 1.1 创建 Next.js 项目

使用 `create-next-app` CLI 工具创建一个新的 Next.js 项目：

```bash
npx create-next-app@latest my-blog --typescript --tailwind --app --src-dir --import-alias "@/*"
```

这个命令会创建一个带有以下配置的 Next.js 项目：
- TypeScript 支持
- Tailwind CSS 集成
- App Router 架构
- src 目录结构
- @/* 导入别名

### 1.2 安装依赖

进入项目目录并安装所需的依赖：

```bash
cd my-blog
npm install drizzle-orm postgres next-auth zod react-hook-form
npm install -D drizzle-kit @types/node @types/react @types/react-dom
```

### 1.3 配置项目

#### 1.3.1 配置环境变量

创建 `.env.local` 文件，配置数据库连接和认证相关的环境变量：

```env
# 数据库配置
DATABASE_URL="postgresql://username:password@localhost:5432/my-blog"

# NextAuth 配置
NEXTAUTH_SECRET="your-secret-key"
NEXTAUTH_URL="http://localhost:3000"

# GitHub OAuth 配置（可选）
GITHUB_CLIENT_ID="your-github-client-id"
GITHUB_CLIENT_SECRET="your-github-client-secret"
```

#### 1.3.2 配置 Drizzle ORM

创建 `drizzle.config.ts` 文件，配置 Drizzle ORM：

```typescript
import { defineConfig } from 'drizzle-kit';

export default defineConfig({
  schema: './src/models/*',
  out: './drizzle',
  dialect: 'postgresql',
  dbCredentials: {
    url: process.env.DATABASE_URL!,
  },
});
```

#### 1.3.3 配置 NextAuth

创建 `src/lib/auth.ts` 文件，配置 NextAuth：

```typescript
import NextAuth from 'next-auth';
import CredentialsProvider from 'next-auth/providers/credentials';
import { db } from './db';
import { users } from '@/models/user';
import { eq } from 'drizzle-orm';
import bcrypt from 'bcryptjs';

export const { handlers, auth, signIn, signOut } = NextAuth({
  providers: [
    CredentialsProvider({
      name: 'Credentials',
      credentials: {
        email: { label: 'Email', type: 'email' },
        password: { label: 'Password', type: 'password' },
      },
      async authorize(credentials) {
        if (!credentials?.email || !credentials?.password) {
          return null;
        }

        const [user] = await db.select().from(users).where(eq(users.email, credentials.email));

        if (!user) {
          return null;
        }

        const isPasswordValid = await bcrypt.compare(credentials.password, user.password);

        if (!isPasswordValid) {
          return null;
        }

        return {
          id: user.id,
          email: user.email,
          name: user.name,
          role: user.role,
        };
      },
    }),
  ],
  callbacks: {
    jwt({ token, user }) {
      if (user) {
        token.id = user.id;
        token.role = user.role;
      }
      return token;
    },
    session({ session, token }) {
      if (session.user) {
        session.user.id = token.id as string;
        session.user.role = token.role as string;
      }
      return session;
    },
  },
  pages: {
    signIn: '/auth/login',
    signOut: '/auth/logout',
    error: '/auth/error',
  },
});
```

## 二、数据模型设计

### 2.1 创建数据库模型

#### 2.1.1 用户模型

创建 `src/models/user.ts` 文件：

```typescript
import { pgTable, uuid, varchar, timestamp, boolean, text, enum as pgEnum } from 'drizzle-orm/pg-core';

export const roleEnum = pgEnum('role', ['USER', 'ADMIN']);

export const users = pgTable('users', {
  id: uuid('id').defaultRandom().primaryKey(),
  name: varchar('name', { length: 255 }).notNull(),
  email: varchar('email', { length: 255 }).unique().notNull(),
  emailVerified: timestamp('email_verified'),
  image: varchar('image', { length: 255 }),
  password: varchar('password', { length: 255 }).notNull(),
  role: roleEnum('role').default('USER').notNull(),
  createdAt: timestamp('created_at').defaultNow().notNull(),
  updatedAt: timestamp('updated_at').defaultNow().notNull(),
});

export type User = typeof users.$inferSelect;
export type NewUser = typeof users.$inferInsert;
```

#### 2.1.2 文章模型

创建 `src/models/post.ts` 文件：

```typescript
import { pgTable, uuid, varchar, text, timestamp, boolean, foreignKey } from 'drizzle-orm/pg-core';
import { users } from './user';

export const posts = pgTable('posts', {
  id: uuid('id').defaultRandom().primaryKey(),
  title: varchar('title', { length: 255 }).notNull(),
  slug: varchar('slug', { length: 255 }).unique().notNull(),
  content: text('content').notNull(),
  excerpt: varchar('excerpt', { length: 500 }).notNull(),
  coverImage: varchar('cover_image', { length: 255 }),
  published: boolean('published').default(false).notNull(),
  authorId: uuid('author_id').references(() => users.id).notNull(),
  createdAt: timestamp('created_at').defaultNow().notNull(),
  updatedAt: timestamp('updated_at').defaultNow().notNull(),
});

export type Post = typeof posts.$inferSelect;
export type NewPost = typeof posts.$inferInsert;
```

#### 2.1.3 分类和标签模型

创建 `src/models/category.ts` 和 `src/models/tag.ts` 文件：

```typescript
// src/models/category.ts
import { pgTable, uuid, varchar, timestamp } from 'drizzle-orm/pg-core';

export const categories = pgTable('categories', {
  id: uuid('id').defaultRandom().primaryKey(),
  name: varchar('name', { length: 100 }).notNull(),
  slug: varchar('slug', { length: 100 }).unique().notNull(),
  createdAt: timestamp('created_at').defaultNow().notNull(),
  updatedAt: timestamp('updated_at').defaultNow().notNull(),
});

export type Category = typeof categories.$inferSelect;
export type NewCategory = typeof categories.$inferInsert;
```

```typescript
// src/models/tag.ts
import { pgTable, uuid, varchar, timestamp } from 'drizzle-orm/pg-core';

export const tags = pgTable('tags', {
  id: uuid('id').defaultRandom().primaryKey(),
  name: varchar('name', { length: 50 }).notNull(),
  slug: varchar('slug', { length: 50 }).unique().notNull(),
  createdAt: timestamp('created_at').defaultNow().notNull(),
  updatedAt: timestamp('updated_at').defaultNow().notNull(),
});

export type Tag = typeof tags.$inferSelect;
export type NewTag = typeof tags.$inferInsert;
```

#### 2.1.4 关联表

创建 `src/models/relations.ts` 文件，定义多对多关联：

```typescript
import { pgTable, uuid, foreignKey } from 'drizzle-orm/pg-core';
import { posts } from './post';
import { categories } from './category';
import { tags } from './tag';
import { users } from './user';

export const postCategories = pgTable('post_categories', {
  postId: uuid('post_id')
    .references(() => posts.id, { onDelete: 'cascade' })
    .notNull(),
  categoryId: uuid('category_id')
    .references(() => categories.id, { onDelete: 'cascade' })
    .notNull(),
});

export const postTags = pgTable('post_tags', {
  postId: uuid('post_id')
    .references(() => posts.id, { onDelete: 'cascade' })
    .notNull(),
  tagId: uuid('tag_id')
    .references(() => tags.id, { onDelete: 'cascade' })
    .notNull(),
});

export const postLikes = pgTable('post_likes', {
  userId: uuid('user_id')
    .references(() => users.id, { onDelete: 'cascade' })
    .notNull(),
  postId: uuid('post_id')
    .references(() => posts.id, { onDelete: 'cascade' })
    .notNull(),
});
```

### 2.2 初始化数据库

运行以下命令初始化数据库：

```bash
npx drizzle-kit push:pg
```

这个命令会根据模型定义创建数据库表。

## 三、认证系统实现

### 3.1 创建认证页面

#### 3.1.1 登录页面

创建 `src/app/auth/login/page.tsx` 文件：

```typescript
'use client';

import { signIn } from 'next-auth/react';
import { useForm } from 'react-hook-form';
import { zodResolver } from '@hookform/resolvers/zod';
import { z } from 'zod';

const loginSchema = z.object({
  email: z.string().email('Invalid email address'),
  password: z.string().min(6, 'Password must be at least 6 characters'),
});

type LoginForm = z.infer<typeof loginSchema>;

export default function LoginPage() {
  const { register, handleSubmit, formState: { errors } } = useForm<LoginForm>({
    resolver: zodResolver(loginSchema),
  });

  const onSubmit = async (data: LoginForm) => {
    await signIn('credentials', { ...data, redirect: true, callbackUrl: '/' });
  };

  return (
    <div className="max-w-md mx-auto mt-10 p-6 bg-white rounded-lg shadow-md">
      <h1 className="text-2xl font-bold mb-6 text-center">Login</h1>
      <form onSubmit={handleSubmit(onSubmit)} className="space-y-4">
        <div>
          <label htmlFor="email" className="block text-sm font-medium text-gray-700">
            Email
          </label>
          <input
            id="email"
            type="email"
            {...register('email')}
            className="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
            placeholder="your@email.com"
          />
          {errors.email && <p className="mt-1 text-sm text-red-600">{errors.email.message}</p>}
        </div>
        <div>
          <label htmlFor="password" className="block text-sm font-medium text-gray-700">
            Password
          </label>
          <input
            id="password"
            type="password"
            {...register('password')}
            className="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
            placeholder="Your password"
          />
          {errors.password && <p className="mt-1 text-sm text-red-600">{errors.password.message}</p>}
        </div>
        <div>
          <button
            type="submit"
            className="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"
          >
            Sign in
          </button>
        </div>
      </form>
    </div>
  );
}
```

#### 3.1.2 注册页面

创建 `src/app/auth/register/page.tsx` 文件，实现用户注册功能。

### 3.2 保护路由

创建 `src/lib/protect-route.ts` 文件，用于保护需要认证的路由：

```typescript
import { auth } from './auth';

export async function protectRoute() {
  const session = await auth();
  if (!session?.user) {
    throw new Error('Unauthorized');
  }
  return session;
}

export async function protectAdminRoute() {
  const session = await auth();
  if (!session?.user || session.user.role !== 'ADMIN') {
    throw new Error('Forbidden');
  }
  return session;
}
```

## 四、文章管理功能

### 4.1 创建文章列表页面

创建 `src/app/blog/page.tsx` 文件：

```typescript
import { db } from '@/lib/db';
import { posts, users } from '@/models';
import { eq, desc } from 'drizzle-orm';
import Link from 'next/link';

export default async function BlogPage() {
  const allPosts = await db
    .select({
      id: posts.id,
      title: posts.title,
      slug: posts.slug,
      excerpt: posts.excerpt,
      coverImage: posts.coverImage,
      published: posts.published,
      createdAt: posts.createdAt,
      author: {
        name: users.name,
        image: users.image,
      },
    })
    .from(posts)
    .innerJoin(users, eq(posts.authorId, users.id))
    .where(eq(posts.published, true))
    .orderBy(desc(posts.createdAt));

  return (
    <div className="max-w-4xl mx-auto py-12">
      <h1 className="text-3xl font-bold mb-8">Blog</h1>
      <div className="grid grid-cols-1 md:grid-cols-2 gap-8">
        {allPosts.map((post) => (
          <article key={post.id} className="bg-white rounded-lg shadow-md overflow-hidden">
            {post.coverImage && (
              <div className="h-48 bg-cover bg-center" style={{ backgroundImage: `url(${post.coverImage})` }} />
            )}
            <div className="p-6">
              <div className="flex items-center mb-4">
                {post.author.image && (
                  <img
                    src={post.author.image}
                    alt={post.author.name}
                    className="w-8 h-8 rounded-full mr-3"
                  />
                )}
                <span className="text-sm text-gray-600">{post.author.name}</span>
                <span className="mx-2 text-gray-400">•</span>
                <span className="text-sm text-gray-600">{new Date(post.createdAt).toLocaleDateString()}</span>
              </div>
              <h2 className="text-xl font-bold mb-2">
                <Link href={`/blog/${post.slug}`} className="text-blue-600 hover:text-blue-800">
                  {post.title}
                </Link>
              </h2>
              <p className="text-gray-600 mb-4">{post.excerpt}</p>
              <Link
                href={`/blog/${post.slug}`}
                className="inline-block text-blue-600 hover:text-blue-800 font-medium"
              >
                Read more →
              </Link>
            </div>
          </article>
        ))}
      </div>
    </div>
  );
}
```

### 4.2 创建文章详情页面

创建 `src/app/blog/[slug]/page.tsx` 文件：

```typescript
import { db } from '@/lib/db';
import { posts, users, comments } from '@/models';
import { eq, desc } from 'drizzle-orm';
import { notFound } from 'next/navigation';

export default async function PostPage({ params }: { params: { slug: string } }) {
  const post = await db
    .select({
      id: posts.id,
      title: posts.title,
      content: posts.content,
      slug: posts.slug,
      coverImage: posts.coverImage,
      published: posts.published,
      createdAt: posts.createdAt,
      updatedAt: posts.updatedAt,
      author: {
        id: users.id,
        name: users.name,
        image: users.image,
      },
      comments: db
        .select({
          id: comments.id,
          content: comments.content,
          createdAt: comments.createdAt,
          author: {
            name: users.name,
            image: users.image,
          },
        })
        .from(comments)
        .innerJoin(users, eq(comments.authorId, users.id))
        .where(eq(comments.postId, posts.id))
        .orderBy(desc(comments.createdAt)),
    })
    .from(posts)
    .innerJoin(users, eq(posts.authorId, users.id))
    .where(eq(posts.slug, params.slug))
    .limit(1)
    .then((res) => res[0]);

  if (!post || !post.published) {
    notFound();
  }

  return (
    <div className="max-w-4xl mx-auto py-12">
      <article className="bg-white rounded-lg shadow-md overflow-hidden">
        {post.coverImage && (
          <div className="h-64 bg-cover bg-center" style={{ backgroundImage: `url(${post.coverImage})` }} />
        )}
        <div className="p-8">
          <div className="flex items-center mb-6">
            {post.author.image && (
              <img
                src={post.author.image}
                alt={post.author.name}
                className="w-12 h-12 rounded-full mr-4"
              />
            )}
            <div>
              <h3 className="font-medium">{post.author.name}</h3>
              <p className="text-sm text-gray-600">{new Date(post.createdAt).toLocaleDateString()}</p>
            </div>
          </div>
          <h1 className="text-3xl font-bold mb-6">{post.title}</h1>
          <div className="prose max-w-none mb-8" dangerouslySetInnerHTML={{ __html: post.content }} />
          <div className="border-t pt-8">
            <h2 className="text-xl font-bold mb-4">Comments ({post.comments.length})</h2>
            <div className="space-y-6">
              {post.comments.map((comment) => (
                <div key={comment.id} className="flex">
                  {comment.author.image && (
                    <img
                      src={comment.author.image}
                      alt={comment.author.name}
                      className="w-8 h-8 rounded-full mr-3 mt-1"
                    />
                  )}
                  <div>
                    <div className="flex items-center mb-1">
                      <span className="font-medium">{comment.author.name}</span>
                      <span className="mx-2 text-gray-400">•</span>
                      <span className="text-sm text-gray-600">{new Date(comment.createdAt).toLocaleDateString()}</span>
                    </div>
                    <p className="text-gray-700">{comment.content}</p>
                  </div>
                </div>
              ))}
            </div>
          </div>
        </div>
      </article>
    </div>
  );
}
```

### 4.3 创建文章编辑器

创建 `src/app/dashboard/posts/new/page.tsx` 文件，实现文章创建功能：

```typescript
'use client';

import { useForm } from 'react-hook-form';
import { zodResolver } from '@hookform/resolvers/zod';
import { z } from 'zod';
import { useRouter } from 'next/navigation';

const postSchema = z.object({
  title: z.string().min(3, 'Title must be at least 3 characters'),
  slug: z.string().min(3, 'Slug must be at least 3 characters'),
  excerpt: z.string().min(10, 'Excerpt must be at least 10 characters'),
  content: z.string().min(50, 'Content must be at least 50 characters'),
  coverImage: z.string().optional(),
  published: z.boolean().default(false),
});

type PostForm = z.infer<typeof postSchema>;

export default function NewPostPage() {
  const router = useRouter();
  const { register, handleSubmit, formState: { errors } } = useForm<PostForm>({
    resolver: zodResolver(postSchema),
    defaultValues: {
      published: false,
    },
  });

  const onSubmit = async (data: PostForm) => {
    const response = await fetch('/api/posts', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify(data),
    });

    if (response.ok) {
      router.push('/dashboard/posts');
    }
  };

  return (
    <div className="max-w-4xl mx-auto py-12">
      <h1 className="text-3xl font-bold mb-8">Create New Post</h1>
      <form onSubmit={handleSubmit(onSubmit)} className="space-y-6">
        {/* Form fields */}
        <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div>
            <label htmlFor="title" className="block text-sm font-medium text-gray-700">
              Title
            </label>
            <input
              id="title"
              type="text"
              {...register('title')}
              className="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
            />
            {errors.title && <p className="mt-1 text-sm text-red-600">{errors.title.message}</p>}
          </div>
          <div>
            <label htmlFor="slug" className="block text-sm font-medium text-gray-700">
              Slug
            </label>
            <input
              id="slug"
              type="text"
              {...register('slug')}
              className="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
            />
            {errors.slug && <p className="mt-1 text-sm text-red-600">{errors.slug.message}</p>}
          </div>
        </div>
        <div>
          <label htmlFor="excerpt" className="block text-sm font-medium text-gray-700">
            Excerpt
          </label>
          <textarea
            id="excerpt"
            rows={3}
            {...register('excerpt')}
            className="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
          />
          {errors.excerpt && <p className="mt-1 text-sm text-red-600">{errors.excerpt.message}</p>}
        </div>
        <div>
          <label htmlFor="content" className="block text-sm font-medium text-gray-700">
            Content
          </label>
          <textarea
            id="content"
            rows={10}
            {...register('content')}
            className="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
          />
          {errors.content && <p className="mt-1 text-sm text-red-600">{errors.content.message}</p>}
        </div>
        <div>
          <label htmlFor="coverImage" className="block text-sm font-medium text-gray-700">
            Cover Image URL
          </label>
          <input
            id="coverImage"
            type="text"
            {...register('coverImage')}
            className="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
          />
          {errors.coverImage && <p className="mt-1 text-sm text-red-600">{errors.coverImage.message}</p>}
        </div>
        <div className="flex items-center">
          <input
            id="published"
            type="checkbox"
            {...register('published')}
            className="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"
          />
          <label htmlFor="published" className="ml-2 block text-sm text-gray-700">
            Publish immediately
          </label>
        </div>
        <div className="flex justify-end space-x-4">
          <button
            type="button"
            onClick={() => router.push('/dashboard/posts')}
            className="py-2 px-4 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"
          >
            Cancel
          </button>
          <button
            type="submit"
            className="py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"
          >
            Create Post
          </button>
        </div>
      </form>
    </div>
  );
}
```

### 4.4 创建文章 API 路由

创建 `src/app/api/posts/route.ts` 文件：

```typescript
import { NextResponse } from 'next/server';
import { db } from '@/lib/db';
import { posts } from '@/models/post';
import { protectRoute } from '@/lib/protect-route';
import { eq } from 'drizzle-orm';

export async function GET() {
  const allPosts = await db.select().from(posts);
  return NextResponse.json(allPosts);
}

export async function POST(request: Request) {
  const session = await protectRoute();
  const body = await request.json();

  const newPost = await db.insert(posts).values({
    ...body,
    authorId: session.user.id,
  }).returning();

  return NextResponse.json(newPost[0]);
}

export async function PUT(request: Request) {
  const session = await protectRoute();
  const body = await request.json();

  const updatedPost = await db.update(posts)
    .set(body)
    .where(eq(posts.id, body.id))
    .returning();

  return NextResponse.json(updatedPost[0]);
}

export async function DELETE(request: Request) {
  const session = await protectRoute();
  const { searchParams } = new URL(request.url);
  const id = searchParams.get('id');

  if (!id) {
    return NextResponse.json({ error: 'Missing id' }, { status: 400 });
  }

  const deletedPost = await db.delete(posts)
    .where(eq(posts.id, id))
    .returning();

  return NextResponse.json(deletedPost[0]);
}
```

## 五、评论功能实现

### 5.1 创建评论表单组件

创建 `src/components/CommentForm.tsx` 文件：

```typescript
'use client';

import { useForm } from 'react-hook-form';
import { zodResolver } from '@hookform/resolvers/zod';
import { z } from 'zod';
import { useSession } from 'next-auth/react';
import { useRouter } from 'next/navigation';

const commentSchema = z.object({
  content: z.string().min(1, 'Comment cannot be empty'),
});

type CommentForm = z.infer<typeof commentSchema>;

interface CommentFormProps {
  postId: string;
}

export default function CommentForm({ postId }: CommentFormProps) {
  const { data: session } = useSession();
  const router = useRouter();
  const { register, handleSubmit, reset, formState: { errors } } = useForm<CommentForm>({
    resolver: zodResolver(commentSchema),
  });

  const onSubmit = async (data: CommentForm) => {
    if (!session?.user) {
      router.push('/auth/login');
      return;
    }

    const response = await fetch(`/api/posts/${postId}/comments`, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify(data),
    });

    if (response.ok) {
      reset();
      router.refresh();
    }
  };

  return (
    <div className="mt-8">
      <h3 className="text-lg font-medium mb-4">Leave a Comment</h3>
      {!session?.user ? (
        <p className="text-gray-600">
          Please <a href="/auth/login" className="text-blue-600 hover:text-blue-800">sign in</a> to leave a comment.
        </p>
      ) : (
        <form onSubmit={handleSubmit(onSubmit)} className="space-y-4">
          <div>
            <textarea
              id="content"
              rows={4}
              {...register('content')}
              className="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
              placeholder="Write your comment..."
            />
            {errors.content && <p className="mt-1 text-sm text-red-600">{errors.content.message}</p>}
          </div>
          <div className="flex justify-end">
            <button
              type="submit"
              className="py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"
            >
              Post Comment
            </button>
          </div>
        </form>
      )}
    </div>
  );
}
```

### 5.2 创建评论 API 路由

创建 `src/app/api/posts/[id]/comments/route.ts` 文件，实现评论的创建和获取功能。

## 六、个人中心实现

### 6.1 创建个人资料页面

创建 `src/app/dashboard/profile/page.tsx` 文件，实现用户资料管理功能。

### 6.2 创建我的文章页面

创建 `src/app/dashboard/posts/page.tsx` 文件，显示用户自己的文章列表。

## 七、管理员功能实现

### 7.1 创建管理员仪表盘

创建 `src/app/admin/page.tsx` 文件：

```typescript
import { protectAdminRoute } from '@/lib/protect-route';
import { db } from '@/lib/db';
import { users, posts, comments } from '@/models';
import { count, eq } from 'drizzle-orm';

export default async function AdminDashboard() {
  await protectAdminRoute();

  const [userCount, postCount, commentCount] = await Promise.all([
    db.select({ count: count() }).from(users),
    db.select({ count: count() }).from(posts),
    db.select({ count: count() }).from(comments),
  ]);

  return (
    <div className="max-w-6xl mx-auto py-12">
      <h1 className="text-3xl font-bold mb-8">Admin Dashboard</h1>
      <div className="grid grid-cols-1 md:grid-cols-3 gap-6 mb-12">
        <div className="bg-white rounded-lg shadow-md p-6">
          <h2 className="text-xl font-semibold mb-2">Total Users</h2>
          <p className="text-3xl font-bold text-blue-600">{userCount[0].count}</p>
        </div>
        <div className="bg-white rounded-lg shadow-md p-6">
          <h2 className="text-xl font-semibold mb-2">Total Posts</h2>
          <p className="text-3xl font-bold text-green-600">{postCount[0].count}</p>
        </div>
        <div className="bg-white rounded-lg shadow-md p-6">
          <h2 className="text-xl font-semibold mb-2">Total Comments</h2>
          <p className="text-3xl font-bold text-purple-600">{commentCount[0].count}</p>
        </div>
      </div>
      {/* More admin content */}
    </div>
  );
}
```

### 7.2 创建用户管理页面

创建 `src/app/admin/users/page.tsx` 文件，实现用户管理功能。

## 八、总结

在本章节中，我们实现了 Next.js 博客平台的核心功能，包括：

1. 项目初始化和配置
2. 数据模型设计和数据库初始化
3. 用户认证和授权系统
4. 文章管理功能
5. 评论功能
6. 个人中心
7. 管理员功能

通过这些功能的实现，我们将前面学习的 Next.js 知识应用到了实际项目中，掌握了 Next.js 全栈开发的完整流程。

在接下来的章节中，我们将学习如何优化项目性能、编写测试用例，并将项目部署到生产环境。

---

**下一章预告**：Next.js 实战项目 - 项目优化和测试

在接下来的章节中，我们将学习如何优化 Next.js 应用的性能，编写测试用例，并进行端到端测试。
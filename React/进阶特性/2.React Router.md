# React Router 详解

## 1. React Router 基本概念

React Router 是一个用于 React 应用的强大路由库，它允许你在单页应用（SPA）中实现客户端路由，实现页面之间的导航而无需刷新整个页面。

### 1.1 核心概念

- **路由（Route）**：定义 URL 路径与组件之间的映射关系
- **导航（Navigation）**：在不同路由之间切换的机制
- **参数（Params）**：从 URL 中提取的动态值
- **嵌套路由（Nested Routes）**：路由的层级结构，允许组件嵌套
- **路由守卫（Navigation Guards）**：控制路由访问权限的机制

### 1.2 React Router 版本

React Router 有多个版本，目前最新的稳定版是 v7.x，它支持 React 18 和 React 19，提供了更现代化的 API 和更好的性能。

## 2. 安装和配置

### 2.1 安装

使用 npm 或 yarn 安装 React Router：

```bash
# 使用 npm
npm install react-router-dom

# 使用 yarn
yarn add react-router-dom
```

### 2.2 基本配置

React Router v7 提供了两种配置方式：声明式路由和数据路由。

#### 声明式路由

```javascript
import React from "react";
import ReactDOM from "react-dom/client";
import { BrowserRouter, Routes, Route } from "react-router";
import App from "./app";
import About from "./about";
import Contact from "./contact";

const root = document.getElementById("root");

ReactDOM.createRoot(root).render(
  <BrowserRouter>
    <Routes>
      <Route path="/" element={<App />} />
      <Route path="about" element={<About />} />
      <Route path="contact" element={<Contact />} />
    </Routes>
  </BrowserRouter>
);
```

#### 数据路由

```javascript
import React from "react";
import { createRoot } from "react-dom/client";
import {
  createBrowserRouter,
  RouterProvider,
  Route,
  Link,
} from "react-router-dom";

const router = createBrowserRouter([
  {
    path: "/",
    element: (
      <div>
        <h1>Hello World</h1>
        <Link to="about">About Us</Link>
      </div>
    ),
  },
  {
    path: "about",
    element: <div>About</div>,
  },
  {
    path: "contact",
    element: <div>Contact</div>,
  },
]);

createRoot(document.getElementById("root")).render(
  <RouterProvider router={router} />
);
```

## 3. 基本路由设置

### 3.1 路由组件

React Router 提供了几个核心组件用于设置路由：

- **BrowserRouter**：使用 HTML5 History API 实现路由
- **Routes**：包含多个 Route 组件，用于匹配当前 URL
- **Route**：定义路径与组件的映射关系
- **Link**：用于导航的组件，类似于 HTML 的 `<a>` 标签
- **Navigate**：用于编程式导航的组件

### 3.2 基本示例

```javascript
import { BrowserRouter, Routes, Route, Link } from "react-router-dom";

function App() {
  return (
    <div>
      <nav>
        <ul>
          <li>
            <Link to="/">Home</Link>
          </li>
          <li>
            <Link to="/about">About</Link>
          </li>
          <li>
            <Link to="/contact">Contact</Link>
          </li>
        </ul>
      </nav>
      
      <Routes>
        <Route path="/" element={<Home />} />
        <Route path="/about" element={<About />} />
        <Route path="/contact" element={<Contact />} />
      </Routes>
    </div>
  );
}

function Home() {
  return <h2>Home</h2>;
}

function About() {
  return <h2>About</h2>;
}

function Contact() {
  return <h2>Contact</h2>;
}

function Root() {
  return (
    <BrowserRouter>
      <App />
    </BrowserRouter>
  );
}
```

## 4. 导航

React Router 提供了多种导航方式：

### 4.1 使用 Link 组件

```javascript
import { Link } from "react-router-dom";

function Navigation() {
  return (
    <nav>
      <Link to="/">Home</Link>
      <Link to="/about">About</Link>
      <Link to="/contact">Contact</Link>
    </nav>
  );
}
```

### 4.2 使用 NavLink 组件

NavLink 组件可以根据当前 URL 自动添加激活样式：

```javascript
import { NavLink } from "react-router-dom";

function Navigation() {
  return (
    <nav>
      <NavLink 
        to="/" 
        className={({ isActive }) => isActive ? "active" : ""}
      >
        Home
      </NavLink>
      <NavLink 
        to="/about" 
        className={({ isActive }) => isActive ? "active" : ""}
      >
        About
      </NavLink>
    </nav>
  );
}
```

### 4.3 编程式导航

使用 useNavigate Hook 进行编程式导航：

```javascript
import { useNavigate } from "react-router-dom";

function LoginForm() {
  const navigate = useNavigate();
  
  const handleLogin = () => {
    // 登录逻辑
    navigate("/dashboard");
  };
  
  const handleCancel = () => {
    navigate(-1); // 返回到上一页
  };
  
  return (
    <div>
      <form onSubmit={handleLogin}>
        {/* 表单字段 */}
        <button type="submit">Login</button>
        <button type="button" onClick={handleCancel}>Cancel</button>
      </form>
    </div>
  );
}
```

## 5. 动态路由

动态路由允许你从 URL 中提取参数，例如 `/users/123` 中的 `123` 是一个动态参数。

### 5.1 定义动态路由

```javascript
import { Routes, Route, Link, useParams } from "react-router-dom";

function App() {
  return (
    <div>
      <nav>
        <Link to="/users/1">User 1</Link>
        <Link to="/users/2">User 2</Link>
      </nav>
      
      <Routes>
        <Route path="/users/:id" element={<User />} />
      </Routes>
    </div>
  );
}

function User() {
  const { id } = useParams();
  return <h2>User ID: {id}</h2>;
}
```

### 5.2 多个动态参数

```javascript
<Route path="/users/:userId/posts/:postId" element={<Post />} />

function Post() {
  const { userId, postId } = useParams();
  return <h2>User {userId}, Post {postId}</h2>;
}
```

### 5.3 查询参数

使用 useSearchParams Hook 处理查询参数：

```javascript
import { useSearchParams } from "react-router-dom";

function SearchResults() {
  const [searchParams, setSearchParams] = useSearchParams();
  const query = searchParams.get("q") || "";
  const sort = searchParams.get("sort") || "asc";
  
  const handleSortChange = (newSort) => {
    setSearchParams({ q: query, sort: newSort });
  };
  
  return (
    <div>
      <h2>Search Results for: {query}</h2>
      <div>
        <button onClick={() => handleSortChange("asc")}>Sort Ascending</button>
        <button onClick={() => handleSortChange("desc")}>Sort Descending</button>
      </div>
      {/* 显示搜索结果 */}
    </div>
  );
}
```

## 6. 嵌套路由

嵌套路由允许你创建路由的层级结构，实现组件的嵌套渲染。

### 6.1 定义嵌套路由

```javascript
import { createBrowserRouter, RouterProvider } from "react-router-dom";

const router = createBrowserRouter([
  {
    path: "/",
    element: <Layout />,
    children: [
      {
        index: true,
        element: <Home />,
      },
      {
        path: "about",
        element: <About />,
      },
      {
        path: "users",
        element: <Users />,
        children: [
          {
            index: true,
            element: <UsersList />,
          },
          {
            path: ":id",
            element: <UserDetail />,
          },
        ],
      },
    ],
  },
]);

function Layout() {
  return (
    <div>
      <nav>
        {/* 导航链接 */}
      </nav>
      <main>
        <Outlet /> {/* 渲染子路由组件 */}
      </main>
    </div>
  );
}
```

### 6.2 使用 Outlet 组件

Outlet 组件用于渲染嵌套路由的子组件：

```javascript
import { Outlet } from "react-router-dom";

function Layout() {
  return (
    <div>
      <header>
        <h1>My App</h1>
      </header>
      <nav>
        {/* 导航链接 */}
      </nav>
      <main>
        <Outlet /> {/* 子路由组件将在这里渲染 */}
      </main>
      <footer>
        {/* 页脚内容 */}
      </footer>
    </div>
  );
}
```

## 7. 路由守卫

路由守卫用于控制路由的访问权限，例如只有登录用户才能访问某些页面。

### 7.1 使用 Navigate 组件实现简单的路由守卫

```javascript
import { Navigate, useLocation } from "react-router-dom";

function ProtectedRoute({ children }) {
  const isAuthenticated = checkIfUserIsAuthenticated(); // 自定义认证逻辑
  const location = useLocation();
  
  if (!isAuthenticated) {
    // 保存当前位置，登录后可以重定向回来
    return <Navigate to="/login" state={{ from: location }} replace />;
  }
  
  return children;
}

// 使用 ProtectedRoute
<Route 
  path="/dashboard" 
  element={
    <ProtectedRoute>
      <Dashboard />
    </ProtectedRoute>
  } 
/>
```

### 7.2 在登录组件中重定向到之前的位置

```javascript
import { useNavigate, useLocation } from "react-router-dom";

function Login() {
  const navigate = useNavigate();
  const location = useLocation();
  const from = location.state?.from?.pathname || "/";
  
  const handleLogin = () => {
    // 登录逻辑
    navigate(from, { replace: true });
  };
  
  return (
    <div>
      <h2>Login</h2>
      <form onSubmit={handleLogin}>
        {/* 表单字段 */}
        <button type="submit">Login</button>
      </form>
    </div>
  );
}
```

## 8. 路由配置最佳实践

### 8.1 集中管理路由配置

将路由配置集中在一个文件中，便于管理和维护：

```javascript
// src/routes.js
import { createBrowserRouter } from "react-router-dom";
import Layout from "./components/Layout";
import Home from "./pages/Home";
import About from "./pages/About";
import Users from "./pages/Users";
import UserDetail from "./pages/UserDetail";
import NotFound from "./pages/NotFound";

const router = createBrowserRouter([
  {
    path: "/",
    element: <Layout />,
    errorElement: <NotFound />,
    children: [
      {
        index: true,
        element: <Home />,
      },
      {
        path: "about",
        element: <About />,
      },
      {
        path: "users",
        element: <Users />,
        children: [
          {
            path: ":id",
            element: <UserDetail />,
          },
        ],
      },
    ],
  },
]);

export default router;

// src/index.js
import { RouterProvider } from "react-router-dom";
import router from "./routes";

createRoot(document.getElementById("root")).render(
  <RouterProvider router={router} />
);
```

### 8.2 使用错误边界

为路由添加错误边界，处理组件渲染错误：

```javascript
import { createBrowserRouter } from "react-router-dom";

const router = createBrowserRouter([
  {
    path: "/",
    element: <Layout />,
    errorElement: <ErrorPage />, // 错误边界组件
    children: [
      // 路由配置
    ],
  },
]);

function ErrorPage() {
  const error = useRouteError();
  return (
    <div>
      <h2>Oops! Something went wrong.</h2>
      <p>{error.statusText || error.message}</p>
    </div>
  );
}
```

### 8.3 懒加载路由组件

使用 React.lazy 和 Suspense 实现路由组件的懒加载，提高应用的初始加载速度：

```javascript
import { lazy, Suspense } from "react";
import { createBrowserRouter } from "react-router-dom";

const Home = lazy(() => import("./pages/Home"));
const About = lazy(() => import("./pages/About"));
const Users = lazy(() => import("./pages/Users"));

const router = createBrowserRouter([
  {
    path: "/",
    element: (
      <Suspense fallback={<div>Loading...</div>}>
        <Layout />
      </Suspense>
    ),
    children: [
      {
        index: true,
        element: <Home />,
      },
      {
        path: "about",
        element: <About />,
      },
      {
        path: "users",
        element: <Users />,
      },
    ],
  },
]);
```

## 9. 示例应用：博客系统

### 9.1 路由配置

```javascript
import { createBrowserRouter } from "react-router-dom";
import Layout from "./components/Layout";
import Home from "./pages/Home";
import PostList from "./pages/PostList";
import PostDetail from "./pages/PostDetail";
import CreatePost from "./pages/CreatePost";
import EditPost from "./pages/EditPost";
import Login from "./pages/Login";
import ProtectedRoute from "./components/ProtectedRoute";

const router = createBrowserRouter([
  {
    path: "/",
    element: <Layout />,
    children: [
      { index: true, element: <Home /> },
      { path: "posts", element: <PostList /> },
      { path: "posts/:id", element: <PostDetail /> },
      {
        path: "posts/new",
        element: (
          <ProtectedRoute>
            <CreatePost />
          </ProtectedRoute>
        ),
      },
      {
        path: "posts/:id/edit",
        element: (
          <ProtectedRoute>
            <EditPost />
          </ProtectedRoute>
        ),
      },
      { path: "login", element: <Login /> },
    ],
  },
]);

export default router;
```

### 9.2 主要组件

```javascript
// Layout.jsx
import { Outlet, NavLink } from "react-router-dom";

function Layout() {
  return (
    <div className="app">
      <header>
        <h1>My Blog</h1>
        <nav>
          <NavLink to="/">Home</NavLink>
          <NavLink to="/posts">Posts</NavLink>
          <NavLink to="/posts/new">Create Post</NavLink>
        </nav>
      </header>
      <main>
        <Outlet />
      </main>
      <footer>
        <p>© 2024 My Blog</p>
      </footer>
    </div>
  );
}

// PostList.jsx
import { Link } from "react-router-dom";

function PostList() {
  const posts = [
    { id: 1, title: "First Post" },
    { id: 2, title: "Second Post" },
  ];
  
  return (
    <div>
      <h2>Posts</h2>
      <ul>
        {posts.map(post => (
          <li key={post.id}>
            <Link to={`/posts/${post.id}`}>{post.title}</Link>
          </li>
        ))}
      </ul>
    </div>
  );
}

// PostDetail.jsx
import { useParams, Link, useNavigate } from "react-router-dom";

function PostDetail() {
  const { id } = useParams();
  const navigate = useNavigate();
  const post = { id: parseInt(id), title: "Post Title", content: "Post content..." };
  
  const handleDelete = () => {
    // 删除逻辑
    navigate("/posts");
  };
  
  return (
    <div>
      <h2>{post.title}</h2>
      <p>{post.content}</p>
      <div>
        <Link to={`/posts/${id}/edit`}>Edit</Link>
        <button onClick={handleDelete}>Delete</button>
      </div>
    </div>
  );
}
```

## 10. 总结

React Router 是 React 应用中实现客户端路由的强大工具，它提供了丰富的 API 和灵活的配置方式。通过学习 React Router，你可以：

- 实现单页应用的导航功能
- 创建动态路由，处理 URL 参数
- 实现嵌套路由，构建复杂的页面结构
- 使用路由守卫控制访问权限
- 优化应用性能，实现懒加载

React Router 7 提供了更现代化的 API 和更好的性能，支持 React 18 和 React 19 的新特性。掌握 React Router 是构建复杂 React 应用的重要技能之一。

## 学习建议

1. **实践项目**：构建一个完整的博客系统或电商应用，使用 React Router 实现路由功能
2. **阅读源码**：查看 React Router 的源码，理解其内部实现原理
3. **学习高级特性**：了解 React Router 的高级特性，如数据加载、导航阻塞等
4. **关注更新**：关注 React Router 的最新版本和特性，保持技术更新
5. **学习 TypeScript**：使用 TypeScript 编写 React Router 应用，提高代码的类型安全性

通过不断实践和学习，你将能够熟练掌握 React Router，构建出高性能、可维护的 React 应用。